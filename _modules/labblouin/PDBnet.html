<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>labblouin.PDBnet &mdash; LabBlouinTools 0.3.4 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.3.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="LabBlouinTools 0.3.4 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">LabBlouinTools 0.3.4 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for labblouin.PDBnet</h1><div class="highlight"><pre>
<span class="c">#!/bin/python</span>

<span class="sd">&#39;&#39;&#39; PDBnet is a collection of Python objects intended to model and contain</span>
<span class="sd">PDB protein data.</span>

<span class="sd">PDBnet Copyright (C) 2012 Christian Blouin</span>
<span class="sd">Contributions by Alex Safatli and Jose Sergio Hleap</span>
<span class="sd">Major Refactoring (2014) done by Alex Safatli and Jose Sergio Hleap</span>

<span class="sd">E-mail: cblouin@cs.dal.ca, safatli@cs.dal.ca, jshleap@dal.ca</span>
<span class="sd">Dependencies: Scipy, BioPython, FASTAnet (contained in LabBlouinTools) &#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">mmap</span> <span class="kn">import</span> <span class="n">mmap</span> <span class="k">as</span> <span class="n">memoryMappedFile</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">FASTAnet</span><span class="o">,</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">getsize</span> <span class="k">as</span> <span class="n">sizeOfFile</span>
<span class="kn">from</span> <span class="nn">Bio.SeqUtils.ProtParam</span> <span class="kn">import</span> <span class="n">ProteinAnalysis</span> <span class="k">as</span> <span class="n">PA</span>
<span class="kn">from</span> <span class="nn">scipy.spatial.distance</span> <span class="kn">import</span> <span class="n">cdist</span>

<span class="c"># Metadata</span>

<span class="n">__author__</span>  <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Christian Blouin&#39;</span><span class="p">,</span><span class="s">&#39;Jose Sergio Hleap&#39;</span><span class="p">,</span><span class="s">&#39;Alexander Safatli&#39;</span><span class="p">]</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s">&#39;1.0.3&#39;</span>

<span class="c"># Constants</span>

<span class="n">PDB_LARGE_FILE_SIZE</span> <span class="o">=</span> <span class="mi">100000000</span> <span class="c">#bytes</span>

<span class="c"># Classes</span>

<div class="viewcode-block" id="PDBatom"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBatom">[docs]</a><span class="k">class</span> <span class="nc">PDBatom</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39; ATOM in a PDB protein structure. &#39;&#39;&#39;</span>

    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span><span class="s">&#39;serial&#39;</span><span class="p">,</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="s">&#39;y&#39;</span><span class="p">,</span><span class="s">&#39;z&#39;</span><span class="p">,</span><span class="s">&#39;occupancy&#39;</span><span class="p">,</span><span class="s">&#39;tempFactor&#39;</span><span class="p">,</span>
                 <span class="s">&#39;charge&#39;</span><span class="p">,</span><span class="s">&#39;symbol&#39;</span><span class="p">,</span><span class="s">&#39;parent&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">serial</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">oc</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">symbol</span><span class="p">,</span><span class="n">charge</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Construct an atom in a PDB protein structure. &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span>       <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">serial</span>     <span class="o">=</span> <span class="n">serial</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span>          <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span>          <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z</span>          <span class="o">=</span> <span class="n">z</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">occupancy</span>  <span class="o">=</span> <span class="n">oc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tempFactor</span> <span class="o">=</span> <span class="n">b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">charge</span>     <span class="o">=</span> <span class="n">charge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span>     <span class="o">=</span> <span class="n">symbol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>     <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="PDBatom.fixname"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBatom.fixname">[docs]</a>    <span class="k">def</span> <span class="nf">fixname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Ensures the name of this atom fits within 4 characters. &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="s">&#39; &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Express this atom as a single line in a PDB file (see PDB format). &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="s">&quot;ATOM  </span><span class="si">%5s</span><span class="s"> </span><span class="si">%4s</span><span class="s"> </span><span class="si">%3s</span><span class="s"> </span><span class="si">%1s%4s</span><span class="s">    </span><span class="si">%8.3f%8.3f%8.3f%6.2f%6.2f</span><span class="s">          </span><span class="si">%2s%2s</span><span class="s">&quot;</span> \
               <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">serial</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">fixname</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">chain</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">occupancy</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">tempFactor</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="p">)</span>

<div class="viewcode-block" id="PDBatom.GetPosition"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBatom.GetPosition">[docs]</a>    <span class="k">def</span> <span class="nf">GetPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 

        <span class="sd">&#39;&#39;&#39; Get the 3-dimensional coordinate of this atom in space. &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PDBatom.DistanceTo"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBatom.DistanceTo">[docs]</a>    <span class="k">def</span> <span class="nf">DistanceTo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Acquire the distance from this atom to another atom. &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">-</span><span class="n">atom</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">-</span><span class="n">atom</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="o">-</span><span class="n">atom</span><span class="o">.</span><span class="n">z</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
</div></div>
<div class="viewcode-block" id="PDBterminator"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBterminator">[docs]</a><span class="k">class</span> <span class="nc">PDBterminator</span><span class="p">(</span><span class="n">PDBatom</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39; A placeholder class that represents a terminating ATOM-like line in the PDB file. &#39;&#39;&#39;</span>

    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span><span class="s">&#39;serial&#39;</span><span class="p">,</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="s">&#39;y&#39;</span><span class="p">,</span><span class="s">&#39;z&#39;</span><span class="p">,</span><span class="s">&#39;occupancy&#39;</span><span class="p">,</span><span class="s">&#39;tempFactor&#39;</span><span class="p">,</span>
                 <span class="s">&#39;charge&#39;</span><span class="p">,</span><span class="s">&#39;symbol&#39;</span><span class="p">,</span><span class="s">&#39;parent&#39;</span><span class="p">,</span><span class="s">&#39;lastatom&#39;</span><span class="p">,</span><span class="s">&#39;lastresname&#39;</span><span class="p">,</span>
                 <span class="s">&#39;lastreschain&#39;</span><span class="p">,</span><span class="s">&#39;lastresind&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">chaininst</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lastatom</span> <span class="o">=</span> <span class="n">chaininst</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastresname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastatom</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastreschain</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">lastatom</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">chain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastresind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastatom</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">index</span>
        <span class="n">newserial</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lastatom</span><span class="o">.</span><span class="n">serial</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PDBterminator</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">newserial</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="s">&#39;TER   </span><span class="si">%5s</span><span class="s"> </span><span class="si">%4s</span><span class="s"> </span><span class="si">%3s</span><span class="s"> </span><span class="si">%1s%4s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">serial</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lastresname</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lastreschain</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lastresind</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PDBresidue"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBresidue">[docs]</a><span class="k">class</span> <span class="nc">PDBresidue</span><span class="p">:</span>

    <span class="sd">&#39;&#39;&#39; A residue (collection of ATOM fields) in a PDB protein structure. &#39;&#39;&#39;</span>

    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;index&#39;</span><span class="p">,</span><span class="s">&#39;name&#39;</span><span class="p">,</span><span class="s">&#39;atoms&#39;</span><span class="p">,</span><span class="s">&#39;atomsOrdered&#39;</span><span class="p">,</span><span class="s">&#39;contacts&#39;</span><span class="p">,</span><span class="s">&#39;centroid&#39;</span><span class="p">,</span>
                 <span class="s">&#39;chain&#39;</span><span class="p">,</span><span class="s">&#39;model&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Construct a residue (collection of atoms) in a PDB protein structure. &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atomsOrdered</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centroid</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chain</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="PDBresidue.GetAtoms"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBresidue.GetAtoms">[docs]</a>    <span class="k">def</span> <span class="nf">GetAtoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomsOrdered</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="PDBresidue.AddAtom"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBresidue.AddAtom">[docs]</a>    <span class="k">def</span> <span class="nf">AddAtom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Add a PDBatom structure to this residue. &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">atom</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="n">atom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atomsOrdered</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
        <span class="n">atom</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="PDBresidue.GetCA"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBresidue.GetCA">[docs]</a>    <span class="k">def</span> <span class="nf">GetCA</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Get the alpha-carbon found in this residue as a PDBatom. &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s">&#39;CA&#39;</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="PDBresidue.Centroid"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBresidue.Centroid">[docs]</a>    <span class="k">def</span> <span class="nf">Centroid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Calculate the centroid of this residue. Return this as a PDBatom. &#39;&#39;&#39;</span>

        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">atom</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="s">&#39;O&#39;</span><span class="p">]:</span> <span class="k">continue</span>
            <span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span><span class="o">.</span><span class="n">x</span>
            <span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span><span class="o">.</span><span class="n">y</span>
            <span class="n">z</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span><span class="o">.</span><span class="n">z</span>

        <span class="n">div</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">/=</span> <span class="n">div</span>
        <span class="n">y</span> <span class="o">/=</span> <span class="n">div</span>
        <span class="n">z</span> <span class="o">/=</span> <span class="n">div</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">centroid</span> <span class="o">=</span> <span class="n">PDBatom</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="s">&#39;centroid&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">centroid</span>
</div>
<div class="viewcode-block" id="PDBresidue.InContactWith"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBresidue.InContactWith">[docs]</a>    <span class="k">def</span> <span class="nf">InContactWith</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">,</span><span class="n">thres</span><span class="o">=</span><span class="mf">4.5</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Determine if in contact with another residue. &#39;&#39;&#39;</span>

        <span class="n">foundmatch</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">atomA</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">atomA</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;C&#39;</span><span class="p">,</span> <span class="s">&#39;N&#39;</span><span class="p">,</span> <span class="s">&#39;O&#39;</span><span class="p">]:</span>
                <span class="k">continue</span>
            <span class="n">atomA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">atomA</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">atomB</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">atomB</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;C&#39;</span><span class="p">,</span> <span class="s">&#39;N&#39;</span><span class="p">,</span> <span class="s">&#39;O&#39;</span><span class="p">]:</span>
                    <span class="k">continue</span>   
                <span class="n">atomB</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">atomB</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">atomA</span><span class="o">.</span><span class="n">DistanceTo</span><span class="p">(</span><span class="n">atomB</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">thres</span><span class="p">:</span>
                    <span class="n">foundmatch</span> <span class="o">=</span> <span class="bp">True</span>

                <span class="k">if</span> <span class="n">foundmatch</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">foundmatch</span><span class="p">:</span> 
                <span class="k">break</span>     

        <span class="k">return</span> <span class="n">foundmatch</span>        
</div>
    <span class="k">def</span> <span class="nf">__int__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomsOrdered</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="PDBchain"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBchain">[docs]</a><span class="k">class</span> <span class="nc">PDBchain</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39; A PDB chain (collection of protein residues). &#39;&#39;&#39;</span>

    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span><span class="s">&#39;structure&#39;</span><span class="p">,</span><span class="s">&#39;residues&#39;</span><span class="p">,</span><span class="s">&#39;indices&#39;</span><span class="p">,</span><span class="s">&#39;parent&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span>       <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">residues</span>   <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indices</span>    <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>  <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>     <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="PDBchain.GetResidues"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBchain.GetResidues">[docs]</a>    <span class="k">def</span> <span class="nf">GetResidues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 

        <span class="sd">&#39;&#39;&#39; Acquire all of the residues in this chain. Note that if this</span>
<span class="sd">		is a large file, this will force the object to load all of these</span>
<span class="sd">		residues into memory from the file. &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">GetResidueByIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIndices</span><span class="p">()]</span>
</div>
<div class="viewcode-block" id="PDBchain.IterResidues"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBchain.IterResidues">[docs]</a>    <span class="k">def</span> <span class="nf">IterResidues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Iteratively yield all of the residues in this chain. Note that if this</span>
<span class="sd">		is a large file, this will force the object to load all of these</span>
<span class="sd">		residues into memory from the file. &#39;&#39;&#39;</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIndices</span><span class="p">():</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetResidueByIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PDBchain.GetResidueByIndex"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBchain.GetResidueByIndex">[docs]</a>    <span class="k">def</span> <span class="nf">GetResidueByIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="p">):</span> 

        <span class="sd">&#39;&#39;&#39; Alias for acquiring a residue from this instance using [] operator. &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PDBchain.GetAtoms"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBchain.GetAtoms">[docs]</a>    <span class="k">def</span> <span class="nf">GetAtoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 

        <span class="sd">&#39;&#39;&#39; Get all comprising atoms in this chain in order of residues. &#39;&#39;&#39;</span>

        <span class="n">atoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">IterResidues</span><span class="p">():</span>
            <span class="n">atoms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">atoms</span>
</div>
<div class="viewcode-block" id="PDBchain.GetIndices"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBchain.GetIndices">[docs]</a>    <span class="k">def</span> <span class="nf">GetIndices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 

        <span class="sd">&#39;&#39;&#39; Acquire all of the indices for residues present in this chain. &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">]</span>    
</div>
<div class="viewcode-block" id="PDBchain.AddIndexOfResidue"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBchain.AddIndexOfResidue">[docs]</a>    <span class="k">def</span> <span class="nf">AddIndexOfResidue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Add an index for a residue to this chain. Will generate own residue</span>
<span class="sd">		information if called upon (forces lazy evaluation). &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="PDBchain.AddResidue"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBchain.AddResidue">[docs]</a>    <span class="k">def</span> <span class="nf">AddResidue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">resid</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Add a residue to this chain. &#39;&#39;&#39;</span>

        <span class="n">resid</span><span class="o">.</span><span class="n">chain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">residues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">resid</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="PDBchain.AddResidueByIndex"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBchain.AddResidueByIndex">[docs]</a>    <span class="k">def</span> <span class="nf">AddResidueByIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Add a residue to this chain by its index in the PDB. The residue</span>
<span class="sd">		object will automatically be constructed from the file. &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
        <span class="n">resid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetResidueByIndex</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">residues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resid</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PDBchain.RemoveResidue"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBchain.RemoveResidue">[docs]</a>    <span class="k">def</span> <span class="nf">RemoveResidue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">resid</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Remove a residue from this chain. &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">resid</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PDBchain.ContactMap"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBchain.ContactMap">[docs]</a>    <span class="k">def</span> <span class="nf">ContactMap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">thres</span><span class="o">=</span><span class="mf">4.5</span><span class="p">):</span>
        
        <span class="sd">&#39;&#39;&#39; Compute the contact map of this chain. &#39;&#39;&#39;</span>
        
        <span class="n">done</span>       <span class="o">=</span> <span class="p">[]</span>
        <span class="n">contactmap</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rA</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">rB</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">resA</span><span class="p">,</span><span class="n">resB</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">rA</span><span class="p">],</span><span class="bp">self</span><span class="p">[</span><span class="n">rB</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">resA</span> <span class="o">==</span> <span class="n">resB</span> <span class="ow">or</span> <span class="p">(</span><span class="n">resA</span><span class="p">,</span><span class="n">resB</span><span class="p">)</span> <span class="ow">in</span> <span class="n">done</span><span class="p">:</span> <span class="k">continue</span>  
                <span class="k">elif</span> <span class="n">resA</span><span class="o">.</span><span class="n">InContactWith</span><span class="p">(</span><span class="n">resB</span><span class="p">,</span><span class="n">thres</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">resA</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">resB</span><span class="p">))</span> <span class="ow">in</span> <span class="n">contactmap</span><span class="p">:</span>
                        <span class="n">contactmap</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">resA</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">resB</span><span class="p">)))</span>
                        <span class="n">contactmap</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">resB</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">resA</span><span class="p">)))</span>
                <span class="n">done</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">resA</span><span class="p">,</span><span class="n">resB</span><span class="p">))</span>
                <span class="n">done</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">resB</span><span class="p">,</span><span class="n">resA</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">contactmap</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</div>
<div class="viewcode-block" id="PDBchain.GetPrimaryPropertiesFromBioPython"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBchain.GetPrimaryPropertiesFromBioPython">[docs]</a>    <span class="k">def</span> <span class="nf">GetPrimaryPropertiesFromBioPython</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Use BioPython to populate this class with attributes. &#39;&#39;&#39;</span>

        <span class="n">props</span><span class="o">=</span><span class="n">PA</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AsFASTA</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amino_acid_composition</span><span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">get_amino_acids_percent</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">molecular_weight</span><span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">molecular_weight</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aromaticity</span><span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">aromaticity</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instability_index</span><span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">instability_index</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flexibility</span><span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">flexibility</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isoelectric_point</span><span class="o">=</span><span class="n">props</span><span class="o">.</span><span class="n">isoelectric_point</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">secondary_structure_fraction</span><span class="o">=</span><span class="n">props</span><span class="o">.</span><span class="n">secondary_structure_fraction</span><span class="p">()</span>        
        <span class="k">return</span> <span class="n">props</span>
</div>
<div class="viewcode-block" id="PDBchain.AsFASTA"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBchain.AsFASTA">[docs]</a>    <span class="k">def</span> <span class="nf">AsFASTA</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Return the string representing this chain&#39;s FASTA sequence. &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">aa</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">IterResidues</span><span class="p">()])</span>
</div>
<div class="viewcode-block" id="PDBchain.WriteAsPDB"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBchain.WriteAsPDB">[docs]</a>    <span class="k">def</span> <span class="nf">WriteAsPDB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Write this single chain to a file as a PDB. &#39;&#39;&#39;</span>

        <span class="n">fh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>        
</div>
<div class="viewcode-block" id="PDBchain.SortByNumericalIndices"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBchain.SortByNumericalIndices">[docs]</a>    <span class="k">def</span> <span class="nf">SortByNumericalIndices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Sort all internal items by a numerical index. &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">handle</span><span class="o">.</span><span class="n">isLargeFile</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">residues</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">residues</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indices</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="PDBchain.pop"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBchain.pop">[docs]</a>    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Pop a residue. &#39;&#39;&#39;</span>

        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetResidueByIndex</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">handle</span><span class="o">.</span><span class="n">isLargeFile</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">residues</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">res</span>
</div>
<div class="viewcode-block" id="PDBchain.update"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBchain.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">o</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Add residues from another chain. &#39;&#39;&#39;</span>

        <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">o</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">AddResidue</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">get</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetResidueByIndex</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">])</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">PDBterminator</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Force the object to load the residue if not present</span>
<span class="sd">		in this structure. &#39;&#39;&#39;</span>

        <span class="n">handle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">handle</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">handle</span> <span class="ow">and</span> <span class="n">handle</span><span class="o">.</span><span class="n">isLargeFile</span><span class="p">())</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">residues</span><span class="p">)):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">resid</span> <span class="o">=</span> <span class="n">handle</span><span class="o">.</span><span class="n">readResidue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">resid</span> <span class="o">=</span> <span class="n">handle</span><span class="o">.</span><span class="n">readResidue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">resid</span><span class="o">.</span><span class="n">chain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
                <span class="k">return</span> <span class="n">resid</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">residues</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))]</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">:</span> <span class="k">yield</span> <span class="nb">int</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PDBmodel"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBmodel">[docs]</a><span class="k">class</span> <span class="nc">PDBmodel</span><span class="p">(</span><span class="n">PDBchain</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39; A PDB model (a special kind of chain). &#39;&#39;&#39;</span>

    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span><span class="s">&#39;structure&#39;</span><span class="p">,</span><span class="s">&#39;residues&#39;</span><span class="p">,</span><span class="s">&#39;indices&#39;</span><span class="p">,</span><span class="s">&#39;chains&#39;</span><span class="p">,</span><span class="s">&#39;chainNames&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;Model names should be integers.&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Model name should be zero or a positive integer.&#39;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PDBmodel</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chains</span>     <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chainNames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

<div class="viewcode-block" id="PDBmodel.GetResidues"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBmodel.GetResidues">[docs]</a>    <span class="k">def</span> <span class="nf">GetResidues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 

        <span class="sd">&#39;&#39;&#39; Acquire all of the residues in this model. Note that if this</span>
<span class="sd">		is a large file, this will force the object to load all of these</span>
<span class="sd">		residues into memory from the file. &#39;&#39;&#39;</span>

        <span class="n">this</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">GetResidueByIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIndices</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">:</span> <span class="n">this</span> <span class="o">+=</span> <span class="n">it</span><span class="o">.</span><span class="n">GetResidues</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">this</span>
</div>
<div class="viewcode-block" id="PDBmodel.IterResidues"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBmodel.IterResidues">[docs]</a>    <span class="k">def</span> <span class="nf">IterResidues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Iteratively yield all of the residues in this model. Note that if this</span>
<span class="sd">		is a large file, this will force the object to load all of these</span>
<span class="sd">		residues into memory from the file. &#39;&#39;&#39;</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIndices</span><span class="p">():</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetResidueByIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">IterResidues</span><span class="p">():</span> <span class="k">yield</span> <span class="n">j</span>
</div>
<div class="viewcode-block" id="PDBmodel.GetChains"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBmodel.GetChains">[docs]</a>    <span class="k">def</span> <span class="nf">GetChains</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span>
</div>
<div class="viewcode-block" id="PDBmodel.GetChain"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBmodel.GetChain">[docs]</a>    <span class="k">def</span> <span class="nf">GetChain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetChainByName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PDBmodel.GetChainByName"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBmodel.GetChainByName">[docs]</a>    <span class="k">def</span> <span class="nf">GetChainByName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chainNames</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chainNames</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="PDBmodel.GetChainNames"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBmodel.GetChainNames">[docs]</a>    <span class="k">def</span> <span class="nf">GetChainNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chainNames</span>
</div>
<div class="viewcode-block" id="PDBmodel.NewChain"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBmodel.NewChain">[docs]</a>    <span class="k">def</span> <span class="nf">NewChain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ch</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Create a new PDBchain, add it to this model, and return it. &#39;&#39;&#39;</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">PDBchain</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddChain</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">c</span>
</div>
<div class="viewcode-block" id="PDBmodel.AddChain"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBmodel.AddChain">[docs]</a>    <span class="k">def</span> <span class="nf">AddChain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">chain</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Add a PDBchain (chain) to this model. &#39;&#39;&#39;</span>

        <span class="n">chain</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>
        <span class="n">chain</span><span class="o">.</span><span class="n">parent</span>    <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chainNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PDBmodel.AddResidue"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBmodel.AddResidue">[docs]</a>    <span class="k">def</span> <span class="nf">AddResidue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">resid</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Add a residue to this model. &#39;&#39;&#39;</span>

        <span class="n">resid</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">residues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">resid</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
</div>
    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>

        <span class="n">handle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">handle</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">handle</span> <span class="ow">and</span> <span class="n">handle</span><span class="o">.</span><span class="n">isLargeFile</span><span class="p">())</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">residues</span><span class="p">):</span>
                <span class="n">resid</span> <span class="o">=</span> <span class="n">handle</span><span class="o">.</span><span class="n">readResidue</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">resid</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
                <span class="k">return</span> <span class="n">resid</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">residues</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))]</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>		

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">model</span> <span class="o">=</span> <span class="s">&#39;MODEL</span><span class="si">%9s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span> <span class="o">+</span> <span class="nb">super</span><span class="p">(</span>
            <span class="n">PDBmodel</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__str__</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">:</span> <span class="n">model</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model</span> <span class="o">+</span> <span class="s">&#39;ENDMDL</span><span class="se">\n</span><span class="s">&#39;</span>
</div>
<div class="viewcode-block" id="PDBstructure"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure">[docs]</a><span class="k">class</span> <span class="nc">PDBstructure</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39; A PDB protein structure (a collection of chains/models). &#39;&#39;&#39;</span>

    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;chains&#39;</span><span class="p">,</span><span class="s">&#39;orderofchains&#39;</span><span class="p">,</span><span class="s">&#39;models&#39;</span><span class="p">,</span><span class="s">&#39;orderofmodels&#39;</span><span class="p">,</span><span class="s">&#39;remarks&#39;</span><span class="p">,</span>
                 <span class="s">&#39;filepath&#39;</span><span class="p">,</span><span class="s">&#39;organism&#39;</span><span class="p">,</span><span class="s">&#39;taxid&#39;</span><span class="p">,</span><span class="s">&#39;mutation&#39;</span><span class="p">,</span><span class="s">&#39;contactmap&#39;</span><span class="p">,</span><span class="s">&#39;handle&#39;</span><span class="p">,</span>
                 <span class="s">&#39;ismodel&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filein</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>

        <span class="c"># Attributes.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span>      <span class="o">=</span> <span class="n">filein</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle</span>        <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">organism</span>      <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">taxid</span>         <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutation</span>      <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contactmap</span>    <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orderofchains</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orderofmodels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remarks</span>       <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chains</span>        <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models</span>        <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c"># Read a file?</span>
        <span class="k">if</span> <span class="n">filein</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ReadFile</span><span class="p">(</span><span class="n">filein</span><span class="p">)</span>

    <span class="c"># Accesssors/Mutators.</span>

<div class="viewcode-block" id="PDBstructure.GetChainNames"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.GetChainNames">[docs]</a>    <span class="k">def</span> <span class="nf">GetChainNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderofchains</span></div>
<div class="viewcode-block" id="PDBstructure.GetModelNames"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.GetModelNames">[docs]</a>    <span class="k">def</span> <span class="nf">GetModelNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderofmodels</span>
</div>
<div class="viewcode-block" id="PDBstructure.GetChain"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.GetChain">[docs]</a>    <span class="k">def</span> <span class="nf">GetChain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ch</span><span class="p">):</span> 

        <span class="sd">&#39;&#39;&#39; Get a chain by name. &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">ch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="PDBstructure.GetModel"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.GetModel">[docs]</a>    <span class="k">def</span> <span class="nf">GetModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mod</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Get a model by name. &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">mod</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">mod</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="PDBstructure.NewChain"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.NewChain">[docs]</a>    <span class="k">def</span> <span class="nf">NewChain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Construct and add a new chain by name to the PDB. Returns the chain. &#39;&#39;&#39;</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">PDBchain</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddChain</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p</span>
</div>
<div class="viewcode-block" id="PDBstructure.NewModel"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.NewModel">[docs]</a>    <span class="k">def</span> <span class="nf">NewModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Construct and add a new model by name to the PDB. Returns the model. &#39;&#39;&#39;</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">PDBmodel</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddModel</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p</span>
</div>
<div class="viewcode-block" id="PDBstructure.RemoveChain"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.RemoveChain">[docs]</a>    <span class="k">def</span> <span class="nf">RemoveChain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Remove a chain from the structure (by name). Returns the chain. &#39;&#39;&#39;</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetChain</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&#39;Chain does not exist in structure by that name!&#39;</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orderofchains</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">c</span>
</div>
<div class="viewcode-block" id="PDBstructure.RemoveModel"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.RemoveModel">[docs]</a>    <span class="k">def</span> <span class="nf">RemoveModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Remove a model from the structure (by name). Returns the chain. &#39;&#39;&#39;</span>

        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetModel</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&#39;Model does not exist in structure by that name!&#39;</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orderofmodels</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">m</span>
</div>
<div class="viewcode-block" id="PDBstructure.AddChain"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.AddChain">[docs]</a>    <span class="k">def</span> <span class="nf">AddChain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">chainname</span><span class="p">,</span><span class="n">chain</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Add a chain as a list of residues to the PDB. &#39;&#39;&#39;</span>

        <span class="c"># Do chain addition operations.</span>
        <span class="k">if</span> <span class="n">chainname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&#39;Chain already exists in structure by that name!&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span> <span class="o">!=</span> <span class="n">PDBchain</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span> <span class="o">==</span> <span class="n">PDBmodel</span><span class="p">:</span>
            <span class="c"># Cast into a PDBchain.</span>
            <span class="n">cast</span> <span class="o">=</span> <span class="n">PDBchain</span><span class="p">(</span><span class="n">chainname</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">:</span> <span class="n">cast</span><span class="o">.</span><span class="n">AddResidue</span><span class="p">(</span><span class="n">chain</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">chain</span> <span class="o">=</span> <span class="n">cast</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">[</span><span class="n">chainname</span><span class="p">]</span> <span class="o">=</span> <span class="n">chain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orderofchains</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chainname</span><span class="p">)</span>
        <span class="n">chain</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="PDBstructure.AddModel"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.AddModel">[docs]</a>    <span class="k">def</span> <span class="nf">AddModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">modelname</span><span class="p">,</span><span class="n">model</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Add a model as a list of residues to the PDB. &#39;&#39;&#39;</span>

        <span class="c"># Do chain addition operations.</span>
        <span class="k">if</span> <span class="n">model</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&#39;Model already exists in structure by that name!&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span> <span class="o">!=</span> <span class="n">PDBmodel</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span> <span class="o">==</span> <span class="n">PDBchain</span><span class="p">:</span>
            <span class="c"># Cast into a PDBmodel.</span>
            <span class="n">cast</span> <span class="o">=</span> <span class="n">PDBmodel</span><span class="p">(</span><span class="n">modelname</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">model</span><span class="p">:</span> <span class="n">cast</span><span class="o">.</span><span class="n">AddResidue</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">cast</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">modelname</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orderofmodels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modelname</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span>
</div>
<div class="viewcode-block" id="PDBstructure.AddResidueToChain"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.AddResidueToChain">[docs]</a>    <span class="k">def</span> <span class="nf">AddResidueToChain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chain</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Add a residue to a chain. Deprecated; use chain class function. &#39;&#39;&#39;</span>

        <span class="n">ch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetChain</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ch</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span> <span class="n">ch</span><span class="o">.</span><span class="n">AddResidue</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PDBstructure.AddResidueToModel"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.AddResidueToModel">[docs]</a>    <span class="k">def</span> <span class="nf">AddResidueToModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Add a residue to a model. Deprecated; use model class function. &#39;&#39;&#39;</span>

        <span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetModel</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mo</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span> <span class="n">mo</span><span class="o">.</span><span class="n">AddResidue</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>      
</div>
<div class="viewcode-block" id="PDBstructure.AddRemark"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.AddRemark">[docs]</a>    <span class="k">def</span> <span class="nf">AddRemark</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">remark</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Add a remark (note/comment) to the structure/PDB file. &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">remark</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remarks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">remark</span><span class="p">),</span><span class="mi">68</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remarks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">remark</span><span class="p">[</span><span class="n">it</span><span class="p">:</span><span class="n">it</span><span class="o">+</span><span class="mi">68</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="PDBstructure.GetRemarks"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.GetRemarks">[docs]</a>    <span class="k">def</span> <span class="nf">GetRemarks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Return all remarks from the PDB as a list of strings. &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">remarks</span>
</div>
<div class="viewcode-block" id="PDBstructure.CheckComplete"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.CheckComplete">[docs]</a>    <span class="k">def</span> <span class="nf">CheckComplete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; For every chain, check to see if every residue is complete (see </span>
<span class="sd">        aa_list dictionary). &#39;&#39;&#39;</span>

        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderofchains</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">re</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">[</span><span class="n">ch</span><span class="p">]:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">[</span><span class="n">ch</span><span class="p">][</span><span class="n">re</span><span class="p">]</span>
                <span class="n">nam</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">name</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">nam</span> <span class="ow">in</span> <span class="n">aa_lists</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">check</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">aa_lists</span><span class="p">[</span><span class="n">nam</span><span class="p">]))</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">check</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">res</span>
        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderofmodels</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">ch</span><span class="p">]:</span>
                <span class="n">nam</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">name</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">nam</span> <span class="ow">in</span> <span class="n">aa_lists</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">check</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">aa_lists</span><span class="p">[</span><span class="n">nam</span><span class="p">]))</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">check</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">res</span>                
        <span class="k">return</span> <span class="bp">True</span>    

    <span class="c"># I/O Functionality.</span>
</div>
    <span class="k">def</span> <span class="nf">_pymol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c"># Start pymol if not started.</span>
        <span class="kn">import</span> <span class="nn">pymol</span>
        <span class="n">pymol</span><span class="o">.</span><span class="n">finish_launching</span><span class="p">()</span>        
        <span class="k">return</span> <span class="n">pymol</span>

<div class="viewcode-block" id="PDBstructure.view"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.view">[docs]</a>    <span class="k">def</span> <span class="nf">view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">istrajectory</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; View the structure in a Pymol window. Requires an installation of Pymol. &#39;&#39;&#39;</span>

        <span class="n">pym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pymol</span><span class="p">()</span>
        <span class="n">pym</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">read_pdbstr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span><span class="s">&#39;PDBnet&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">istrajectory</span><span class="p">:</span>
            <span class="n">pym</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;all_states&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">istrajectory</span><span class="p">:</span> <span class="k">pass</span> <span class="c"># SERGIO</span>
</div>
<div class="viewcode-block" id="PDBstructure.ViewStructure"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.ViewStructure">[docs]</a>    <span class="k">def</span> <span class="nf">ViewStructure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">view</span><span class="p">()</span>    
</div>
<div class="viewcode-block" id="PDBstructure.WriteFile"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.WriteFile">[docs]</a>    <span class="k">def</span> <span class="nf">WriteFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Write this PDB structure as a single PDB file. &#39;&#39;&#39;</span>

        <span class="n">fh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="PDBstructure.read"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Alias for ReadFile(). &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ReadFile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PDBstructure.ReadFile"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.ReadFile">[docs]</a>    <span class="k">def</span> <span class="nf">ReadFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Read a PDB file. Populate this PDBstructure. &#39;&#39;&#39;</span>

        <span class="c"># Map to memory and read the file.</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">PDBfile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remarks</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">organism</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">taxid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutation</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">largeFile</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">isLargeFile</span><span class="p">()</span>

        <span class="c"># Start creating high-level structures for models/chains.</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">hasModels</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ismodel</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NewModel</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">getModelNames</span><span class="p">())</span>		
            <span class="k">for</span> <span class="n">mo</span><span class="p">,</span> <span class="n">ch</span><span class="p">,</span> <span class="n">re</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">iterResidueData</span><span class="p">():</span>
                <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetModel</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ch</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">GetChainNames</span><span class="p">():</span> <span class="n">model</span><span class="o">.</span><span class="n">NewChain</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>
                    <span class="n">chain</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">GetChain</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">largeFile</span><span class="p">:</span> <span class="n">chain</span><span class="o">.</span><span class="n">AddIndexOfResidue</span><span class="p">(</span><span class="n">re</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span> <span class="n">chain</span><span class="o">.</span><span class="n">AddResidueByIndex</span><span class="p">(</span><span class="n">re</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">largeFile</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">AddIndexOfResidue</span><span class="p">(</span><span class="n">re</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">AddResidueByIndex</span><span class="p">(</span><span class="n">re</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">mod</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetModelNames</span><span class="p">():</span>
                <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetModel</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
                <span class="n">model</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span>			
                <span class="n">model</span><span class="o">.</span><span class="n">SortByNumericalIndices</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">GetChains</span><span class="p">():</span>
                    <span class="n">chain</span><span class="o">.</span><span class="n">SortByNumericalIndices</span><span class="p">()</span>		
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ismodel</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NewChain</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">getChainNames</span><span class="p">())</span>			
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">ch</span><span class="p">,</span> <span class="n">re</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">iterResidueData</span><span class="p">():</span>
                <span class="n">chain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetChain</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">largeFile</span><span class="p">:</span> <span class="n">chain</span><span class="o">.</span><span class="n">AddIndexOfResidue</span><span class="p">(</span><span class="n">re</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span> <span class="n">chain</span><span class="o">.</span><span class="n">AddResidueByIndex</span><span class="p">(</span><span class="n">re</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cha</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetChainNames</span><span class="p">():</span>
                <span class="n">chain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetChain</span><span class="p">(</span><span class="n">cha</span><span class="p">)</span>
                <span class="n">chain</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span>					
                <span class="n">chain</span><span class="o">.</span><span class="n">SortByNumericalIndices</span><span class="p">()</span>

        <span class="c"># Remove this component from memory if no longer necessary.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">largeFile</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">del</span> <span class="n">p</span>
</div>
<div class="viewcode-block" id="PDBstructure.ChainAsFASTA"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.ChainAsFASTA">[docs]</a>    <span class="k">def</span> <span class="nf">ChainAsFASTA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chain</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Return the chain as a FASTA. Deprecated; use chain class function. &#39;&#39;&#39;</span>

        <span class="n">ch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetChain</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ch</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="n">ch</span><span class="o">.</span><span class="n">AsFASTA</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="PDBstructure.ModelAsFASTA"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.ModelAsFASTA">[docs]</a>    <span class="k">def</span> <span class="nf">ModelAsFASTA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Return the model as a FASTA. Deprecated; use chain class function. &#39;&#39;&#39;</span>

        <span class="n">mo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetModel</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mo</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="n">mo</span><span class="o">.</span><span class="n">AsFASTA</span><span class="p">()</span>

    <span class="c"># Scoring Functionality</span>
</div>
    <span class="k">def</span> <span class="nf">_iterResidueAssociations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fasta</span><span class="p">,</span><span class="n">chains</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">fast</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; PRIVATE: Use an input FASTA file to determine associations</span>
<span class="sd">        between residues as they exist between 2+ chains. Constructs a</span>
<span class="sd">		mapping between chain and sequence and yields all strictly</span>
<span class="sd">		homologous positions as residues, chain-by-chain.&#39;&#39;&#39;</span>

        <span class="n">ismodel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ismodel</span>
        <span class="k">if</span> <span class="n">ismodel</span><span class="p">:</span>
            <span class="n">orderofthings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderofmodels</span>
            <span class="n">things</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">orderofthings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderofchains</span>
            <span class="n">things</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">chains</span><span class="p">:</span> <span class="n">chains</span> <span class="o">=</span> <span class="n">orderofthings</span>
        <span class="n">chaininds</span> <span class="o">=</span> <span class="p">[</span><span class="n">orderofthings</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">chains</span><span class="p">]</span>  
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chaininds</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Need more than two chains (gave </span><span class="si">%d</span><span class="s">).&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chaininds</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">fast</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fast</span> <span class="o">=</span> <span class="n">FASTAnet</span><span class="o">.</span><span class="n">FASTAstructure</span><span class="p">(</span><span class="n">fasta</span><span class="p">,</span><span class="n">uniqueOnly</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">seqs</span> <span class="o">=</span> <span class="n">fast</span><span class="o">.</span><span class="n">orderedSequences</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">things</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seqs</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&#39;FASTA set length not equal to PDB length.&#39;</span><span class="p">)</span>	
        <span class="n">posv</span> <span class="o">=</span> <span class="n">fast</span><span class="o">.</span><span class="n">getStrictlyUngappedPositions</span><span class="p">(</span><span class="n">chaininds</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">chaininds</span><span class="p">:</span> <span class="c"># Go chain by chain and yield information.</span>
            <span class="n">seq</span> <span class="o">=</span> <span class="n">seqs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">sequence</span>
            <span class="n">ch</span>  <span class="o">=</span> <span class="n">orderofthings</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFASTAIndices</span><span class="p">(</span><span class="n">things</span><span class="p">[</span><span class="n">ch</span><span class="p">],</span><span class="n">seq</span><span class="p">)</span>
            <span class="n">residueList</span> <span class="o">=</span> <span class="p">[</span><span class="n">match</span> <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">residueList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">nm</span> <span class="o">=</span> <span class="n">seqs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
                <span class="n">chn</span> <span class="o">=</span> <span class="n">things</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&#39;No relation found between sequence </span><span class="si">%s</span><span class="s"> and chain </span><span class="si">%s</span><span class="s">.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nm</span><span class="p">,</span><span class="n">chn</span><span class="p">))</span>			
            <span class="n">residueList</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">residueList</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span><span class="n">d</span><span class="o">.</span><span class="n">fstindex</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">posv</span><span class="p">:</span> <span class="c"># Go position by position.</span>
                <span class="k">yield</span> <span class="n">pos</span><span class="p">,</span> <span class="n">ch</span><span class="p">,</span> <span class="n">residueList</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c"># Yield position, chain name, and residue.</span>

<div class="viewcode-block" id="PDBstructure.tmscore"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.tmscore">[docs]</a>    <span class="k">def</span> <span class="nf">tmscore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fasta</span><span class="p">,</span><span class="n">chains</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">native</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">CA</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Get the TMscore between two chains. Requires a </span>
<span class="sd">        FASTA alignment and a value for the length of the</span>
<span class="sd">        native structure (e.g., for a pairwise alignment,</span>
<span class="sd">        the length of the structure used as a reference</span>
<span class="sd">        before alignment was done). The latter is computed</span>
<span class="sd">        by assuming the first of both provided chains is the</span>
<span class="sd">        native structure; otherwise, uses a provided chain</span>
<span class="sd">        name (native input). &#39;&#39;&#39;</span>

        <span class="n">ismodel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ismodel</span>
        <span class="k">if</span> <span class="n">ismodel</span><span class="p">:</span>
            <span class="n">orderofthings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderofmodels</span>
            <span class="n">things</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">orderofthings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderofchains</span>
            <span class="n">things</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">chains</span><span class="p">:</span> <span class="n">chains</span> <span class="o">=</span> <span class="n">orderofthings</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chains</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Need exactly two chains to score.&#39;</span><span class="p">)</span>
        <span class="n">fas</span>     <span class="o">=</span> <span class="n">FASTAnet</span><span class="o">.</span><span class="n">FASTAstructure</span><span class="p">(</span><span class="n">fasta</span><span class="p">,</span><span class="n">uniqueOnly</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">posvect</span> <span class="o">=</span> <span class="n">fas</span><span class="o">.</span><span class="n">getStrictlyUngappedPositions</span><span class="p">()</span>
        <span class="n">items</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterResidueAssociations</span><span class="p">(</span><span class="n">fasta</span><span class="p">,</span><span class="n">chains</span><span class="p">,</span><span class="n">fas</span><span class="p">)</span>

        <span class="c"># Get the lengths of the respective chains.</span>
        <span class="k">if</span> <span class="n">native</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">leN</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">things</span><span class="p">[</span><span class="n">chains</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> 
        <span class="k">else</span><span class="p">:</span> <span class="n">leN</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">things</span><span class="p">[</span><span class="n">native</span><span class="p">])</span> <span class="c"># Length of the reference structure.</span>
        <span class="n">leT</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">posvect</span><span class="p">)</span> <span class="c"># Number of aligned positions.</span>

        <span class="c"># Calculate d_0 for this alignment.</span>
        <span class="n">cuberoot</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">d_0</span> <span class="o">=</span> <span class="mf">1.24</span> <span class="o">*</span> <span class="n">cuberoot</span><span class="p">(</span><span class="n">leN</span><span class="o">-</span><span class="mi">15</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.8</span>

        <span class="c"># Get the summation portion of the TMscore.</span>
        <span class="n">sumportion</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">posmask</span>    <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">pos</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">residue</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">posmask</span><span class="p">:</span> <span class="n">posmask</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">CA</span><span class="p">:</span> <span class="n">atom</span> <span class="o">=</span> <span class="n">residue</span><span class="o">.</span><span class="n">GetCA</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>  <span class="n">atom</span> <span class="o">=</span> <span class="n">residue</span><span class="o">.</span><span class="n">Centroid</span><span class="p">()</span>
            <span class="n">posmask</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">posvect</span><span class="p">:</span> <span class="c"># Assume chA is Native Structure.</span>
            <span class="n">cavect</span>   <span class="o">=</span> <span class="n">posmask</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
            <span class="n">ca1</span><span class="p">,</span> <span class="n">ca2</span> <span class="o">=</span> <span class="n">cavect</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cavect</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">d_i</span>      <span class="o">=</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">ca1</span><span class="o">.</span><span class="n">x</span><span class="o">-</span><span class="n">ca2</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                            <span class="p">(</span><span class="n">ca1</span><span class="o">.</span><span class="n">y</span><span class="o">-</span><span class="n">ca2</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                            <span class="p">(</span><span class="n">ca1</span><span class="o">.</span><span class="n">z</span><span class="o">-</span><span class="n">ca2</span><span class="o">.</span><span class="n">z</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">sumdenom</span>  <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">d_i</span><span class="o">/</span><span class="n">d_0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">suminside</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">sumdenom</span><span class="p">)</span>
            <span class="n">sumportion</span> <span class="o">+=</span> <span class="n">suminside</span>

        <span class="c"># Return the TMscore.</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">leN</span><span class="p">)</span> <span class="o">*</span> <span class="n">sumportion</span>
</div>
<div class="viewcode-block" id="PDBstructure.gdt"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.gdt">[docs]</a>    <span class="k">def</span> <span class="nf">gdt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fasta</span><span class="p">,</span><span class="n">chains</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">distcutoffs</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span><span class="n">CA</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Get the GDT score between two chains. Requires a</span>
<span class="sd">        FASTA alignment. &#39;&#39;&#39;</span>

        <span class="n">ismodel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ismodel</span>

        <span class="k">if</span> <span class="n">ismodel</span><span class="p">:</span>
            <span class="n">orderofthings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderofmodels</span>
            <span class="n">things</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">orderofthings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderofchains</span>
            <span class="n">things</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">distcutoffs</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Need exactly 4 distance cutoff values.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">chains</span><span class="p">:</span> <span class="n">chains</span> <span class="o">=</span> <span class="n">orderofthings</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chains</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Need exactly two chains to score.&#39;</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterResidueAssociations</span><span class="p">(</span><span class="n">fasta</span><span class="p">,</span><span class="n">chains</span><span class="p">)</span>

        <span class="c"># Get all relevant atoms.</span>
        <span class="n">posmask</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">pos</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">residue</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">posmask</span><span class="p">:</span> <span class="n">posmask</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">CA</span><span class="p">:</span> <span class="n">atom</span> <span class="o">=</span> <span class="n">residue</span><span class="o">.</span><span class="n">GetCA</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>  <span class="n">atom</span> <span class="o">=</span> <span class="n">residue</span><span class="o">.</span><span class="n">Centroid</span><span class="p">()</span>
            <span class="n">posmask</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>		

        <span class="c"># Get the Euclidean distances between</span>
        <span class="c"># all pairs of aligned positions.</span>
        <span class="n">distances</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">posmask</span><span class="p">:</span>
            <span class="n">cavect</span> <span class="o">=</span> <span class="n">posmask</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
            <span class="n">ca1</span><span class="p">,</span> <span class="n">ca2</span> <span class="o">=</span> <span class="n">cavect</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cavect</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">ca1</span><span class="o">.</span><span class="n">x</span><span class="o">-</span><span class="n">ca2</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                        <span class="p">(</span><span class="n">ca1</span><span class="o">.</span><span class="n">y</span><span class="o">-</span><span class="n">ca2</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span>
                        <span class="p">(</span><span class="n">ca1</span><span class="o">.</span><span class="n">z</span><span class="o">-</span><span class="n">ca2</span><span class="o">.</span><span class="n">z</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">distances</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist</span>

        <span class="c"># Calculate the counts for different cutoffs.</span>
        <span class="n">counts</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">poslen</span>  <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">distances</span><span class="p">))</span>
        <span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">D</span> <span class="o">=</span> <span class="n">distcutoffs</span>
        <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">distances</span><span class="p">:</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">distances</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">A</span><span class="p">:</span> <span class="n">counts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">B</span><span class="p">:</span> <span class="n">counts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">C</span><span class="p">:</span> <span class="n">counts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">D</span><span class="p">:</span> <span class="n">counts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">GDT_P1</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">poslen</span>
        <span class="n">GDT_P2</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">poslen</span>
        <span class="n">GDT_P3</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">poslen</span>
        <span class="n">GDT_P4</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="n">poslen</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">GDT_P1</span><span class="o">+</span><span class="n">GDT_P2</span><span class="o">+</span><span class="n">GDT_P3</span><span class="o">+</span><span class="n">GDT_P4</span><span class="p">)</span><span class="o">/</span><span class="mf">4.0</span>
</div>
<div class="viewcode-block" id="PDBstructure.rmsd"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.rmsd">[docs]</a>    <span class="k">def</span> <span class="nf">rmsd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fasta</span><span class="p">,</span><span class="n">chains</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">CA</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;Get the RMSD between chains. Requires a FASTA alignment.&#39;&#39;&#39;</span>

        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterResidueAssociations</span><span class="p">(</span><span class="n">fasta</span><span class="p">,</span><span class="n">chains</span><span class="p">)</span>
        <span class="c"># Get all relevant atoms.</span>
        <span class="n">posmask</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">pos</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">residue</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">posmask</span><span class="p">:</span> <span class="n">posmask</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">CA</span><span class="p">:</span> <span class="n">atom</span> <span class="o">=</span> <span class="n">residue</span><span class="o">.</span><span class="n">GetCA</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>  <span class="n">atom</span> <span class="o">=</span> <span class="n">residue</span><span class="o">.</span><span class="n">Centroid</span><span class="p">()</span>
            <span class="n">posmask</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>			
        <span class="c"># Get the Euclidean distance squared between</span>
        <span class="c"># all pairs of aligned positions.</span>
        <span class="n">distsqs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">posmask</span><span class="p">:</span>
            <span class="n">cavect</span> <span class="o">=</span> <span class="n">posmask</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cavect</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">cavect</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">distsqs</span><span class="p">:</span> <span class="n">distsqs</span><span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">ca1</span><span class="p">,</span> <span class="n">ca2</span> <span class="o">=</span> <span class="n">cavect</span><span class="p">[</span><span class="n">a</span><span class="p">],</span> <span class="n">cavect</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
                    <span class="n">distsq</span> <span class="o">=</span> <span class="p">((</span><span class="n">ca1</span><span class="o">.</span><span class="n">x</span><span class="o">-</span><span class="n">ca2</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
                              <span class="o">+</span><span class="p">(</span><span class="n">ca1</span><span class="o">.</span><span class="n">y</span><span class="o">-</span><span class="n">ca2</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
                              <span class="o">+</span><span class="p">(</span><span class="n">ca1</span><span class="o">.</span><span class="n">z</span><span class="o">-</span><span class="n">ca2</span><span class="o">.</span><span class="n">z</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">distsqs</span><span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">distsq</span>
        <span class="c"># Calculate the average RMSD.</span>
        <span class="n">rmsd</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">distsqs</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">distsqs</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">posmask</span><span class="p">)))</span>
            <span class="n">rmsd</span> <span class="o">+=</span> <span class="n">r</span>
        <span class="n">rmsd</span> <span class="o">/=</span> <span class="nb">len</span><span class="p">(</span><span class="n">distsqs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rmsd</span>
</div>
<div class="viewcode-block" id="PDBstructure.rrmsd"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.rrmsd">[docs]</a>    <span class="k">def</span> <span class="nf">rrmsd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fasta</span><span class="p">,</span><span class="n">chains</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">CA</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Get the RRMSD between chains. Requires a FASTA alignment. </span>
<span class="sd">        See Betancourt &amp; Skolnick, &quot;Universal Similarity Measure for</span>
<span class="sd">        Comparison Protein Structures&quot;. &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ismodel</span><span class="p">:</span>
            <span class="n">orderofthings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderofmodels</span>
            <span class="n">things</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">orderofthings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderofchains</span>
            <span class="n">things</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">chains</span><span class="p">:</span> <span class="n">chains</span> <span class="o">=</span> <span class="n">orderofthings</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chains</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Need exactly two chains to score.&#39;</span><span class="p">)</span>        

        <span class="n">R_A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RadiusOfGyration</span><span class="p">([</span><span class="n">chains</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">R_B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RadiusOfGyration</span><span class="p">([</span><span class="n">chains</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">avglen</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">things</span><span class="p">[</span><span class="n">chains</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span><span class="o">+</span>
                  <span class="nb">len</span><span class="p">(</span><span class="n">things</span><span class="p">[</span><span class="n">chains</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">L_N</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">avglen</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">e</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mf">0.42</span><span class="o">-</span><span class="mf">0.05</span><span class="o">*</span><span class="n">L_N</span><span class="o">*</span><span class="n">e</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">L_N</span><span class="o">/</span><span class="mf">4.7</span><span class="p">)</span><span class="o">+</span><span class="mf">0.63</span><span class="o">*</span><span class="n">e</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">L_N</span><span class="o">/</span><span class="mi">37</span><span class="p">)</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="n">R_A</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">R_B</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">R_A</span><span class="o">*</span><span class="n">R_B</span>
        <span class="n">alignRMSD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmsd</span><span class="p">(</span><span class="n">fasta</span><span class="p">,</span><span class="n">chains</span><span class="p">,</span><span class="n">CA</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">alignRMSD</span><span class="p">)</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="n">denom</span><span class="p">)</span>

    <span class="c"># Other Functionality</span>
</div>
<div class="viewcode-block" id="PDBstructure.GetAverage"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.GetAverage">[docs]</a>    <span class="k">def</span> <span class="nf">GetAverage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">chains</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">newname</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Acquire a new chain or model corresponding to an average of all present</span>
<span class="sd">        chains or models specified. &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ismodel</span><span class="p">:</span>
            <span class="n">orderofthings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderofmodels</span>
            <span class="n">things</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span>
            <span class="k">if</span> <span class="n">newname</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">newname</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">output</span>        <span class="o">=</span> <span class="n">PDBmodel</span><span class="p">(</span><span class="n">newname</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">orderofthings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderofchains</span>
            <span class="n">things</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span>
            <span class="k">if</span> <span class="n">newname</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">newname</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span>
            <span class="n">output</span>        <span class="o">=</span> <span class="n">PDBchain</span><span class="p">(</span><span class="n">newname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">chains</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">chains</span> <span class="o">=</span> <span class="n">orderofthings</span>

        <span class="c"># Make sure all sequences have equal FASTAs.</span>
        <span class="n">fas</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">chains</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fas</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span> <span class="n">fas</span> <span class="o">=</span> <span class="n">things</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">AsFASTA</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">things</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">AsFASTA</span><span class="p">()</span> <span class="o">!=</span> <span class="n">fas</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s">&#39;Not all provided chains/models have equal sequences.&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">avgResidue</span><span class="p">(</span><span class="n">res_no</span><span class="p">):</span>

            <span class="c"># Create the dummy residue structure.</span>
            <span class="n">firstch</span>  <span class="o">=</span> <span class="n">things</span><span class="p">[</span><span class="n">chains</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">firstres</span> <span class="o">=</span> <span class="n">firstch</span><span class="o">.</span><span class="n">GetResidues</span><span class="p">()[</span><span class="n">res_no</span><span class="p">]</span>
            <span class="n">fake</span> <span class="o">=</span> <span class="n">PDBresidue</span><span class="p">(</span><span class="n">firstres</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">firstres</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="c"># Populate it with atoms.</span>
            <span class="n">atomlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">firstres</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">():</span>
                <span class="n">atomlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PDBatom</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">serial</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
                                        <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">))</span>            

            <span class="c"># Average all properties.</span>
            <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chains</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">chains</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">things</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">GetResidueByIndex</span><span class="p">(</span><span class="n">things</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">GetIndices</span><span class="p">()[</span><span class="n">res_no</span><span class="p">])</span>
                <span class="n">atoms</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">)):</span>
                    <span class="n">atomlist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">atoms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span>
                    <span class="n">atomlist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">atoms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">y</span>
                    <span class="n">atomlist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">z</span> <span class="o">+=</span> <span class="n">atoms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">z</span>
                    <span class="n">atomlist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">occupancy</span> <span class="o">+=</span> <span class="n">atoms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">occupancy</span>
                    <span class="n">atomlist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tempFactor</span> <span class="o">+=</span> <span class="n">atoms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tempFactor</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">atomlist</span><span class="p">:</span>
                <span class="n">a</span><span class="o">.</span><span class="n">x</span> <span class="o">/=</span> <span class="nb">float</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
                <span class="n">a</span><span class="o">.</span><span class="n">y</span> <span class="o">/=</span> <span class="nb">float</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
                <span class="n">a</span><span class="o">.</span><span class="n">z</span> <span class="o">/=</span> <span class="nb">float</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
                <span class="n">a</span><span class="o">.</span><span class="n">occupancy</span> <span class="o">/=</span> <span class="nb">float</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
                <span class="n">a</span><span class="o">.</span><span class="n">tempFactor</span> <span class="o">/=</span> <span class="nb">float</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">atomlist</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">AddAtom</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fake</span>

        <span class="n">res_nums</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">things</span><span class="p">[</span><span class="n">chains</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">res_nums</span><span class="p">:</span> <span class="n">output</span><span class="o">.</span><span class="n">AddResidue</span><span class="p">(</span><span class="n">avgResidue</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">output</span>
</div>
<div class="viewcode-block" id="PDBstructure.RadiusOfGyration"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.RadiusOfGyration">[docs]</a>    <span class="k">def</span> <span class="nf">RadiusOfGyration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">chains</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Acquire the radius of the gyration of the entire, or a portion of, the</span>
<span class="sd">        PDB protein molecule. &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ismodel</span><span class="p">:</span>
            <span class="n">orderofthings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderofmodels</span>
            <span class="n">things</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">orderofthings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderofchains</span>
            <span class="n">things</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span>      
        <span class="k">if</span> <span class="ow">not</span> <span class="n">chains</span><span class="p">:</span> <span class="n">chains</span> <span class="o">=</span> <span class="n">orderofthings</span>

        <span class="c"># Get centre of mass of entire molecule.</span>
        <span class="n">molCentroid</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">]</span>
        <span class="n">numAtoms</span>    <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chains</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">re</span> <span class="ow">in</span> <span class="n">things</span><span class="p">[</span><span class="n">c</span><span class="p">]:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">things</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="n">re</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">at</span><span class="p">]</span>
                    <span class="n">molCentroid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">a</span><span class="o">.</span><span class="n">x</span>
                    <span class="n">molCentroid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">a</span><span class="o">.</span><span class="n">y</span>
                    <span class="n">molCentroid</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">a</span><span class="o">.</span><span class="n">z</span>
                    <span class="n">numAtoms</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">m_x</span><span class="p">,</span><span class="n">m_y</span><span class="p">,</span><span class="n">m_z</span> <span class="o">=</span> <span class="n">molCentroid</span>
        <span class="n">molCentroid</span> <span class="o">=</span> <span class="p">[</span><span class="n">m_x</span><span class="o">/</span><span class="n">numAtoms</span><span class="p">,</span><span class="n">m_y</span><span class="o">/</span><span class="n">numAtoms</span><span class="p">,</span><span class="n">m_z</span><span class="o">/</span><span class="n">numAtoms</span><span class="p">]</span>

        <span class="c"># Sum all of the distances squared vs. centre of mass.</span>
        <span class="n">distsqr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">m_x</span><span class="p">,</span><span class="n">m_y</span><span class="p">,</span><span class="n">m_z</span> <span class="o">=</span> <span class="n">molCentroid</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chains</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">re</span> <span class="ow">in</span> <span class="n">things</span><span class="p">[</span><span class="n">c</span><span class="p">]:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">things</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="n">re</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">at</span><span class="p">]</span>
                    <span class="n">diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">x</span><span class="o">-</span><span class="n">m_x</span><span class="o">+</span><span class="n">a</span><span class="o">.</span><span class="n">y</span><span class="o">-</span><span class="n">m_y</span><span class="o">+</span><span class="n">a</span><span class="o">.</span><span class="n">z</span><span class="o">-</span><span class="n">m_z</span><span class="p">)</span>
                    <span class="n">distsqr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diff</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="c"># Return the sum of all of these, divided by number of atoms,</span>
        <span class="c"># square rooted.</span>
        <span class="n">sumdistratio</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">distsqr</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">numAtoms</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">sumdistratio</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PDBstructure.GetAllCentroid"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.GetAllCentroid">[docs]</a>    <span class="k">def</span> <span class="nf">GetAllCentroid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chain</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Populates the centroids of all residues. &#39;&#39;&#39;</span>

        <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">chain</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">chain</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Chain </span><span class="si">%s</span><span class="s"> does not exist!&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">chain</span><span class="p">))</span>

            <span class="n">ch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">[</span><span class="n">chain</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">ch</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">ch</span><span class="p">[</span><span class="n">res</span><span class="p">]</span>
                <span class="n">res</span><span class="o">.</span><span class="n">Centroid</span><span class="p">()</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">centroid</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">IterAllResidues</span><span class="p">():</span>
                <span class="n">res</span><span class="o">.</span><span class="n">Centroid</span><span class="p">()</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">centroid</span><span class="p">)</span>				

        <span class="k">return</span> <span class="n">out</span>
</div>
<div class="viewcode-block" id="PDBstructure.IndexSeq"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.IndexSeq">[docs]</a>    <span class="k">def</span> <span class="nf">IndexSeq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chain</span><span class="p">,</span> <span class="n">fst</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Store in residues the correct index to the fasta.</span>
<span class="sd">        Requires a 1-to-1 correspondance at least a portion</span>
<span class="sd">        of the way through. Deprecated; use GetFASTAIndices(). &#39;&#39;&#39;</span>

        <span class="n">ismodel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ismodel</span>

        <span class="k">if</span> <span class="n">ismodel</span><span class="p">:</span> <span class="n">thing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetModel</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">thing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetChain</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetFASTAIndices</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="n">fst</span><span class="p">)</span>            
</div>
<div class="viewcode-block" id="PDBstructure.GetFASTAIndices"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.GetFASTAIndices">[docs]</a>    <span class="k">def</span> <span class="nf">GetFASTAIndices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thing</span><span class="p">,</span> <span class="n">fst</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Given a PDBchain, find 1-to-1 correspondances between</span>
<span class="sd">        it and a FASTA sequence. &#39;&#39;&#39;</span>

        <span class="n">chainseq</span> <span class="o">=</span> <span class="n">thing</span><span class="o">.</span><span class="n">AsFASTA</span><span class="p">()</span>
        <span class="n">ungapped</span> <span class="o">=</span> <span class="n">fst</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">success</span>  <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ungapped</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chainseq</span><span class="p">):</span>
            <span class="n">success</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">yield</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">chainseq</span><span class="p">)):</span>
            <span class="c"># See if there is a failed correspondance.</span>
            <span class="k">if</span> <span class="n">chainseq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ungapped</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> 
                <span class="k">yield</span> <span class="bp">None</span>
                <span class="n">success</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">thing</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">thing</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">fst</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">aa</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">name</span><span class="p">],</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">i</span><span class="o">.</span><span class="n">fstindex</span> <span class="o">=</span> <span class="n">index</span>
                <span class="k">yield</span> <span class="n">i</span>
</div>
<div class="viewcode-block" id="PDBstructure.IterResiduesFor"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.IterResiduesFor">[docs]</a>    <span class="k">def</span> <span class="nf">IterResiduesFor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">chains</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        
        <span class="sd">&#39;&#39;&#39; Produce an iterator to allow one to iterate over all residues for a subset of the structure. &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ismodel</span><span class="p">:</span>
            <span class="n">orderofthings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderofmodels</span>
            <span class="n">things</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">orderofthings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderofchains</span>
            <span class="n">things</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span>
        <span class="k">if</span> <span class="n">chains</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">chains</span> <span class="o">=</span> <span class="n">orderofthings</span>
        
        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">chains</span><span class="p">:</span>
            <span class="n">chain</span> <span class="o">=</span> <span class="n">things</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">:</span> <span class="k">yield</span> <span class="n">chain</span><span class="p">[</span><span class="n">res</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="PDBstructure.IterAllResidues"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.IterAllResidues">[docs]</a>    <span class="k">def</span> <span class="nf">IterAllResidues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Produce an iterator to allow one to iterate over all possible residues. &#39;&#39;&#39;</span>

        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">chain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetChain</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">:</span> <span class="k">yield</span> <span class="n">chain</span><span class="p">[</span><span class="n">res</span><span class="p">]</span>   
        <span class="k">for</span> <span class="n">mo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetModel</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">model</span><span class="p">:</span> <span class="k">yield</span> <span class="n">model</span><span class="p">[</span><span class="n">res</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="PDBstructure.gm"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.gm">[docs]</a>    <span class="k">def</span> <span class="nf">gm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fasta</span><span class="p">,</span><span class="n">chains</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">CA</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">typeof</span><span class="o">=</span><span class="s">&#39;str&#39;</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Acquire Geometric Morphometric data corresponding to the</span>
<span class="sd">        (x,y,z) coordinates between all homologous residue positions.</span>
<span class="sd">        Requires a FASTA alignment. Options include using alpha-carbon</span>
<span class="sd">        positions. By default, uses centroids of residues. Returns a list</span>
<span class="sd">        of labels and a list of coordinates as raw GM data. The typeof </span>
<span class="sd">		option provides an option for coordinate output; they are returned </span>
<span class="sd">		as a semicolon-delimited string (str) or as a numpy 2d array (matrix). &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ismodel</span><span class="p">:</span>
            <span class="n">orderofthings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderofmodels</span>
            <span class="n">things</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">orderofthings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderofchains</span>
            <span class="n">things</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span>
        <span class="k">if</span> <span class="n">chains</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">chains</span> <span class="o">=</span> <span class="n">orderofthings</span>
        <span class="n">labels</span><span class="p">,</span><span class="n">coords</span> <span class="o">=</span> <span class="p">[],[]</span> <span class="c"># Output Variables</span>

        <span class="c"># Set up name grabbing from FASTA file for GM labelling.</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">FASTAnet</span><span class="o">.</span><span class="n">FASTAstructure</span><span class="p">(</span><span class="n">fasta</span><span class="p">,</span><span class="n">uniqueOnly</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">orderedSequences</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> 

        <span class="c"># Acquire all homologous positions as defined in FASTA.</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterResidueAssociations</span><span class="p">(</span><span class="n">fasta</span><span class="p">,</span><span class="n">chains</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>

        <span class="n">chainsSaw</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">typeof</span> <span class="o">==</span> <span class="s">&#39;matrix&#39;</span><span class="p">:</span> <span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>                  <span class="n">row</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">pos</span><span class="p">,</span><span class="n">chain</span><span class="p">,</span><span class="n">res</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">chain</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">chainsSaw</span><span class="p">:</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">orderofthings</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
                <span class="n">nm</span> <span class="o">=</span> <span class="n">name</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&gt;</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nm</span><span class="p">,</span><span class="n">nm</span><span class="p">[:</span><span class="mi">4</span><span class="p">]))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chainsSaw</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                <span class="n">chainsSaw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">typeof</span> <span class="o">==</span> <span class="s">&#39;matrix&#39;</span><span class="p">:</span> <span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">else</span><span class="p">:</span> <span class="n">row</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>					
            <span class="k">if</span> <span class="n">CA</span><span class="p">:</span> <span class="n">atom</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">GetCA</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>  <span class="n">atom</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">Centroid</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>   <span class="n">row</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%f</span><span class="s">;</span><span class="si">%f</span><span class="s">;</span><span class="si">%f</span><span class="s">;&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">atom</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">atom</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span> <span class="n">row</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">atom</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">atom</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">atom</span><span class="o">.</span><span class="n">z</span><span class="p">])</span>
        <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="c"># Last chain.</span>

        <span class="k">if</span> <span class="n">typeof</span> <span class="o">==</span> <span class="s">&#39;matrix&#39;</span><span class="p">:</span> <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">labels</span><span class="p">,</span><span class="n">coords</span>
</div>
<div class="viewcode-block" id="PDBstructure.WriteGM"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.WriteGM">[docs]</a>    <span class="k">def</span> <span class="nf">WriteGM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fasta</span><span class="p">,</span><span class="n">gm</span><span class="p">,</span><span class="n">chains</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">CA</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Write the information present in this PDB between multiple</span>
<span class="sd">        chains as a Geometric Morphometric text file. This file will be</span>
<span class="sd">        formatted such that individual lines correspond to chains and semi-colons</span>
<span class="sd">        separate the (x,y,z) coordinates between all homologous residue positions. </span>
<span class="sd">        Requires a FASTA alignment. Options include using alpha-carbon positions.</span>
<span class="sd">        By default, uses centroids of residues. &#39;&#39;&#39;</span>

        <span class="n">fgm</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">gm</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>

        <span class="c"># Get raw GM data.</span>
        <span class="n">labels</span><span class="p">,</span><span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gm</span><span class="p">(</span><span class="n">fasta</span><span class="p">,</span><span class="n">chains</span><span class="p">,</span><span class="n">CA</span><span class="p">)</span>

        <span class="c"># Start writing.</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)):</span>
            <span class="n">fgm</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;;&#39;</span> <span class="o">+</span> <span class="n">coords</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="c"># Done.</span>
        <span class="n">fgm</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="PDBstructure.WriteLandmarks"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.WriteLandmarks">[docs]</a>    <span class="k">def</span> <span class="nf">WriteLandmarks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fasta</span><span class="p">,</span><span class="n">lm</span><span class="p">,</span><span class="n">chains</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Write the information present in this PDB between multiple</span>
<span class="sd">        chains as a landmark text file. This file will be formatted such that </span>
<span class="sd">        the file is partitioned in sections starting with chain names and individual </span>
<span class="sd">        lines in these correspond to homologous residue positions denoted by</span>
<span class="sd">        homologous position, residue number, and residue name tab-delimited. Requires</span>
<span class="sd">        a FASTA file. &#39;&#39;&#39;</span>

        <span class="n">ismodel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ismodel</span>

        <span class="k">if</span> <span class="n">ismodel</span><span class="p">:</span>
            <span class="n">orderofthings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderofmodels</span>
            <span class="n">things</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">orderofthings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderofchains</span>
            <span class="n">things</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span>
        <span class="k">if</span> <span class="n">chains</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">chains</span> <span class="o">=</span> <span class="n">orderofthings</span>

        <span class="n">flm</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">lm</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>

        <span class="c"># Set up name grabbing from FASTA file for labelling.</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">FASTAnet</span><span class="o">.</span><span class="n">FASTAstructure</span><span class="p">(</span><span class="n">fasta</span><span class="p">,</span><span class="n">uniqueOnly</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">orderedSequences</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>

        <span class="c"># Acquire all homologous positions as defined in FASTA.</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterResidueAssociations</span><span class="p">(</span><span class="n">fasta</span><span class="p">,</span><span class="n">chains</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>

        <span class="c"># Start writing.</span>
        <span class="n">chainsSaw</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ind</span>       <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">pos</span><span class="p">,</span><span class="n">chain</span><span class="p">,</span><span class="n">res</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">chain</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">chainsSaw</span><span class="p">:</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">orderofthings</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
                <span class="n">nm</span> <span class="o">=</span> <span class="n">name</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">flm</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;&gt;</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nm</span><span class="p">))</span>
                <span class="n">chainsSaw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">flm</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ind</span><span class="p">,</span><span class="n">res</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">res</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="n">ind</span> <span class="o">+=</span> <span class="mi">1</span>

</div>
<div class="viewcode-block" id="PDBstructure.FDmatrix"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.FDmatrix">[docs]</a>    <span class="k">def</span> <span class="nf">FDmatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fasta</span><span class="p">,</span><span class="n">chains</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">scaled</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Compute the form difference matrix (FDM) as explained in Claude 2008. It relates to</span>
<span class="sd">        the identification of the most influential residue, with respect to the overall</span>
<span class="sd">        shape/structure. If the scaled option is True, will return an scaled list </span>
<span class="sd">        (from -1 to 1) of the of lenght equal to the number of residues. Otherwise will return</span>
<span class="sd">        the raw FDM, rounded so it can be included in a PDB. The scaled version is better for</span>
<span class="sd">        vizualization. By default the FDM is computed far all chains, but a subset can be passed</span>
<span class="sd">        to the chains option.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">names</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gm</span><span class="p">(</span><span class="n">fasta</span><span class="p">,</span><span class="n">chains</span><span class="o">=</span><span class="n">chains</span><span class="p">,</span><span class="n">typeof</span><span class="o">=</span><span class="s">&#39;matrix&#39;</span><span class="p">)</span>
        <span class="c">#get dimensions</span>
        <span class="n">n_obs</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>     <span class="c"># number observations/structures</span>
        <span class="n">n_res</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">3</span>   <span class="c"># Number of residues		</span>
        <span class="c"># Re-sahpe data as a 3D array</span>
        <span class="n">data</span><span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_obs</span><span class="p">,</span><span class="n">n_res</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="c"># compute meanshape	</span>
        <span class="n">msh</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c">#compute the form matrix for the mean shape</span>
        <span class="n">FMmsh</span> <span class="o">=</span> <span class="n">cdist</span><span class="p">(</span><span class="n">msh</span><span class="p">,</span><span class="n">msh</span><span class="p">)</span>
        <span class="n">FMmsh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">FMmsh</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">FMmsh</span><span class="p">))</span>
        <span class="c">#iterate over observations to compute the form difference matrix</span>
        <span class="n">vector</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n_obs</span><span class="p">):</span>
            <span class="n">ndarray</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">,:,:]</span>
            <span class="n">FM</span>   <span class="o">=</span> <span class="n">cdist</span><span class="p">(</span><span class="n">ndarray</span><span class="p">,</span><span class="n">ndarray</span><span class="p">)</span>
            <span class="n">FDM</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">FM</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">FM</span><span class="p">))</span><span class="o">/</span><span class="n">FMmsh</span>
            <span class="n">utr</span>  <span class="o">=</span> <span class="n">FDM</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">triu_indices</span><span class="p">(</span><span class="n">FDM</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">k</span><span class="o">=-</span><span class="mi">1</span><span class="p">)]</span>
            <span class="n">mfdm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">FDM</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">utr</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">utr</span><span class="p">)]))</span>
            <span class="n">mdat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">mfdm</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">mfdm</span><span class="p">))</span>
            <span class="n">s</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mdat</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">vector</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="c">#compute FD and scaled if required</span>
        <span class="n">FD</span>  <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">/</span><span class="n">n_obs</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">scaled</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="n">FD</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">FD</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">FD</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">FD</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">FD</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
</div>
<div class="viewcode-block" id="PDBstructure.Map2Protein"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.Map2Protein">[docs]</a>    <span class="k">def</span> <span class="nf">Map2Protein</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">outname</span><span class="p">,</span><span class="n">lis</span><span class="p">,</span><span class="n">chain</span><span class="p">,</span><span class="n">fasta</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Map a list of values (lis), that must have a lenght equal to that of the number</span>
<span class="sd">        of residues in the PDB to be mapped (chain). If a list of list is provided, the </span>
<span class="sd">        first list will be mapped as the beta factor and the second as occupancy</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c"># Check if more than one thing need to be included</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">([</span><span class="n">lis</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">lis</span><span class="o">=</span><span class="p">[</span><span class="n">lis</span><span class="p">]</span>

        <span class="c"># Construct empty PDBstructure.</span>
        <span class="n">dummy</span> <span class="o">=</span> <span class="n">PDBstructure</span><span class="p">()</span>

        <span class="c"># Reset beta and ocuppancy</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetModel</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
            <span class="n">newm</span> <span class="o">=</span> <span class="n">dummy</span><span class="o">.</span><span class="n">NewModel</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">IterResidues</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">():</span>
                    <span class="n">a</span><span class="o">.</span><span class="n">tempFactor</span><span class="o">=</span><span class="mf">0.00</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">occupancy</span><span class="o">=</span><span class="mf">0.00</span>
                <span class="n">newm</span><span class="o">.</span><span class="n">AddResidue</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetChain</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
            <span class="n">newm</span> <span class="o">=</span> <span class="n">dummy</span><span class="o">.</span><span class="n">NewChain</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">GetName</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">IterResidues</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">():</span>
                    <span class="n">a</span><span class="o">.</span><span class="n">tempFactor</span><span class="o">=</span><span class="mf">0.00</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">a</span><span class="o">.</span><span class="n">occupancy</span><span class="o">=</span><span class="mf">0.00</span>
                <span class="n">newm</span><span class="o">.</span><span class="n">AddResidue</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>			

        <span class="c"># Acquire all homologous positions as defined in FASTA.</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterResidueAssociations</span><span class="p">(</span><span class="n">fasta</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span>		

        <span class="c"># populate new field</span>
        <span class="k">for</span> <span class="n">pos</span><span class="p">,</span><span class="n">chainb</span><span class="p">,</span><span class="n">res</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">chainb</span> <span class="o">==</span> <span class="n">chain</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">newm</span><span class="o">.</span><span class="n">GetResidueByIndex</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">():</span>
                <span class="n">a</span><span class="o">.</span><span class="n">tempFactor</span> <span class="o">=</span> <span class="n">lis</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">pos</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">a</span><span class="o">.</span><span class="n">occupancy</span> <span class="o">=</span> <span class="n">lis</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">pos</span><span class="p">]</span>


        <span class="n">newm</span><span class="o">.</span><span class="n">WriteAsPDB</span><span class="p">(</span><span class="n">outname</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PDBstructure.Contacts"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.Contacts">[docs]</a>    <span class="k">def</span> <span class="nf">Contacts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">chain</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">thres</span><span class="o">=</span><span class="mf">4.5</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Compute the contact map of all chains or a chain.</span>
<span class="sd">        :param chains: A list of chain or model names. By default, entire structure.</span>
<span class="sd">        :param thres: A threshold for distinguishing contact in Angstroms.</span>
<span class="sd">        :returns: A list of tuples of indices (integers) which correspond to</span>
<span class="sd">        chains or models and their residues. &#39;&#39;&#39;</span>     

        <span class="n">ismodel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ismodel</span>
        
        <span class="k">if</span> <span class="n">ismodel</span><span class="p">:</span>
            <span class="n">orderofthings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderofmodels</span>
            <span class="n">things</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">orderofthings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderofchains</span>
            <span class="n">things</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span>
            
        <span class="k">if</span> <span class="n">chain</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">chain</span> <span class="o">==</span> <span class="s">&#39;ALL&#39;</span><span class="p">:</span>
            <span class="n">chain</span> <span class="o">=</span> <span class="n">orderofthings</span>

        <span class="n">done</span>            <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contactmap</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">:</span>
                <span class="n">chain</span> <span class="o">=</span> <span class="n">things</span><span class="p">[</span><span class="n">chain</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">chain</span> <span class="o">=</span> <span class="n">things</span><span class="p">[</span><span class="n">chain</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contactmap</span> <span class="o">=</span> <span class="n">chain</span><span class="o">.</span><span class="n">ContactMap</span><span class="p">(</span><span class="n">thres</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c"># A number of chains.</span>
            <span class="n">iteratorA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IterResiduesFor</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
            <span class="n">iteratorB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IterResiduesFor</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">resA</span> <span class="ow">in</span> <span class="n">iteratorA</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">resB</span> <span class="ow">in</span> <span class="n">iteratorB</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">resA</span> <span class="o">==</span> <span class="n">resB</span> <span class="ow">or</span> <span class="p">(</span><span class="n">resA</span><span class="p">,</span><span class="n">resB</span><span class="p">)</span> <span class="ow">in</span> <span class="n">done</span><span class="p">:</span> <span class="k">continue</span> 
                    <span class="k">elif</span> <span class="n">resA</span><span class="o">.</span><span class="n">InContactWith</span><span class="p">(</span><span class="n">resB</span><span class="p">,</span><span class="n">thres</span><span class="p">):</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">ismodel</span><span class="p">:</span>
                            <span class="n">A</span> <span class="o">=</span> <span class="n">resA</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="n">resA</span><span class="o">.</span><span class="n">chain</span>
                            <span class="n">B</span> <span class="o">=</span> <span class="n">resB</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="n">resB</span><span class="o">.</span><span class="n">chain</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">resA</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">resA</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
                            <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">resB</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">resB</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contactmap</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">contactmap</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">))</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">contactmap</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">B</span><span class="p">,</span><span class="n">A</span><span class="p">))</span>
                    <span class="n">done</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">resA</span><span class="p">,</span><span class="n">resB</span><span class="p">))</span>
                    <span class="n">done</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">resB</span><span class="p">,</span><span class="n">resA</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contactmap</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contactmap</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">element</span><span class="p">:</span> <span class="p">(</span>
                <span class="n">element</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">element</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contactmap</span>
</div>
<div class="viewcode-block" id="PDBstructure.WriteContacts"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBstructure.WriteContacts">[docs]</a>    <span class="k">def</span> <span class="nf">WriteContacts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Write contact map. &#39;&#39;&#39;</span>

        <span class="n">fout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contactmap</span><span class="p">:</span>
            <span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span>
        <span class="n">fout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>            

    <span class="c"># Internals</span>
</div>
    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Returns all PDBchains as an iterator. &#39;&#39;&#39;</span>

        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">:</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">mo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">:</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">models</span><span class="p">[</span><span class="n">mo</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Returns the length of the protein. &#39;&#39;&#39;</span>

        <span class="c"># For all chains.</span>
        <span class="n">chs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">chs</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">chs</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_remarksToString</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">remarkstr</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remarks</span><span class="p">)):</span>
            <span class="n">remarkstr</span> <span class="o">+=</span> <span class="s">&#39;REMARK</span><span class="si">%4s</span><span class="s"> </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">it</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">remarks</span><span class="p">[</span><span class="n">it</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">remarkstr</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; As a string, outputs structure in the PDB format. &#39;&#39;&#39;</span>

        <span class="n">out</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remarksToString</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderofchains</span><span class="p">:</span> <span class="n">out</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetChain</span><span class="p">(</span><span class="n">chain</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderofmodels</span><span class="p">:</span> <span class="n">out</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetModel</span><span class="p">(</span><span class="n">model</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">out</span>
</div>
<div class="viewcode-block" id="PDBfile"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBfile">[docs]</a><span class="k">class</span> <span class="nc">PDBfile</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;filePath&#39;</span><span class="p">,</span><span class="s">&#39;fileHandle&#39;</span><span class="p">,</span><span class="s">&#39;memHandle&#39;</span><span class="p">,</span><span class="s">&#39;modelIndices&#39;</span><span class="p">,</span><span class="s">&#39;chains&#39;</span><span class="p">,</span><span class="s">&#39;residueIndices&#39;</span><span class="p">,</span><span class="s">&#39;size&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fi</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filePath</span>       <span class="o">=</span> <span class="n">fi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileHandle</span>     <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fi</span><span class="p">,</span><span class="s">&#39;r+b&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span>           <span class="o">=</span> <span class="n">sizeOfFile</span><span class="p">(</span><span class="n">fi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memHandle</span>      <span class="o">=</span> <span class="n">memoryMappedFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileHandle</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">residueIndices</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelIndices</span>   <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chains</span>         <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

<div class="viewcode-block" id="PDBfile.isLargeFile"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBfile.isLargeFile">[docs]</a>    <span class="k">def</span> <span class="nf">isLargeFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Return whether or on the PDB file this object represents is incredibly large. &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;=</span> <span class="n">PDB_LARGE_FILE_SIZE</span><span class="p">)</span>	
</div>
<div class="viewcode-block" id="PDBfile.close"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBfile.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Close the file. &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">memHandle</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">memHandle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileHandle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="PDBfile.read"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBfile.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Acquire all remarks, and the indices of all models and residues. Returns</span>
<span class="sd">		remarks, and biological source information as a tuple (remarks, organism, </span>
<span class="sd">		taxid, mutant). &#39;&#39;&#39;</span>

        <span class="c"># Metadata.</span>
        <span class="n">remarks</span><span class="p">,</span><span class="n">organism</span><span class="p">,</span><span class="n">taxid</span><span class="p">,</span><span class="n">mutant</span> <span class="o">=</span> <span class="p">[],</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="bp">False</span>

        <span class="c"># Cursors.</span>
        <span class="n">k</span>      <span class="o">=</span> <span class="mi">0</span>
        <span class="n">curRes</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">pos</span>    <span class="o">=</span> <span class="mi">0</span>
        <span class="n">line</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memHandle</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="n">model</span>  <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c"># Scan the file.</span>
        <span class="k">while</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">recordType</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">recordType</span> <span class="o">==</span> <span class="s">&#39;MODEL&#39;</span><span class="p">:</span>
                <span class="n">model</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">modelIndices</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span>
            <span class="k">elif</span> <span class="n">recordType</span> <span class="o">==</span> <span class="s">&#39;ATOM&#39;</span><span class="p">:</span>
                <span class="n">sl</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">sl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">100000</span><span class="p">:</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>							
                <span class="n">chain</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">21</span><span class="o">+</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">chain</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">chains</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
                <span class="n">residue_index</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">22</span><span class="o">+</span><span class="n">k</span><span class="p">:</span><span class="mi">27</span><span class="o">+</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">iCode</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">27</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">residue</span> <span class="o">=</span> <span class="n">residue_index</span> <span class="o">+</span> <span class="n">iCode</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">curRes</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">residue</span> <span class="o">!=</span> <span class="n">curRes</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">residueIndices</span><span class="p">[(</span><span class="n">model</span><span class="p">,</span><span class="n">chain</span><span class="p">,</span><span class="n">residue</span><span class="p">)]</span> <span class="o">=</span> <span class="n">pos</span>
                    <span class="n">curRes</span> <span class="o">=</span> <span class="n">residue</span>
            <span class="k">elif</span> <span class="n">recordType</span> <span class="o">==</span> <span class="s">&#39;REMARK&#39;</span><span class="p">:</span>
                <span class="n">remark</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">remark</span> <span class="ow">in</span> <span class="n">remarks</span><span class="p">:</span> <span class="n">remarks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">remark</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">recordType</span> <span class="o">==</span> <span class="s">&#39;SOURCE&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s">&#39;ORGANISM_SCIENTIFIC&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">organism</span> <span class="o">=</span> <span class="s">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span>
                <span class="k">elif</span> <span class="s">&#39;ORGANISM_TAXID&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">taxid</span>    <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="s">&#39;MUTANT&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">or</span> <span class="s">&#39;MUTATION&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">mutant</span>   <span class="o">=</span> <span class="bp">True</span>
            <span class="n">pos</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memHandle</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memHandle</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memHandle</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c"># Return metadata.</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">remarks</span><span class="p">,</span><span class="n">organism</span><span class="p">,</span><span class="n">taxid</span><span class="p">,</span><span class="n">mutant</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PDBfile.readResidue"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBfile.readResidue">[docs]</a>    <span class="k">def</span> <span class="nf">readResidue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">chain</span><span class="p">,</span><span class="n">res</span><span class="p">,</span><span class="n">model</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Parse a residue from the PDB file and return a PDBresidue. &#39;&#39;&#39;</span>

        <span class="n">resObj</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">residueIndices</span><span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">model</span><span class="p">),</span><span class="n">chain</span><span class="p">,</span><span class="n">res</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memHandle</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memHandle</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">recordType</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">recordType</span> <span class="o">==</span> <span class="s">&#39;ATOM&#39;</span><span class="p">:</span>
                <span class="n">sl</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">sl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">100000</span><span class="p">:</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>		
                <span class="n">chain</span>      <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">21</span><span class="o">+</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">residue</span>    <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">22</span><span class="o">+</span><span class="n">k</span><span class="p">:</span><span class="mi">27</span><span class="o">+</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="n">line</span><span class="p">[</span><span class="mi">27</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">residue_id</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">17</span><span class="o">+</span><span class="n">k</span><span class="p">:</span><span class="mi">20</span><span class="o">+</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">residue</span> <span class="o">==</span> <span class="n">res</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">resObj</span><span class="p">:</span>
                        <span class="n">resObj</span> <span class="o">=</span> <span class="n">PDBresidue</span><span class="p">(</span><span class="n">residue</span><span class="p">,</span><span class="n">residue_id</span><span class="p">)</span>
                    <span class="n">serial</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">6</span><span class="o">+</span><span class="n">k</span><span class="p">:</span><span class="mi">12</span><span class="o">+</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">atom_name</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">12</span><span class="o">+</span><span class="n">k</span><span class="p">:</span><span class="mi">16</span><span class="o">+</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">30</span><span class="o">+</span><span class="n">k</span><span class="p">:</span><span class="mi">38</span><span class="o">+</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">38</span><span class="o">+</span><span class="n">k</span><span class="p">:</span><span class="mi">46</span><span class="o">+</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">46</span><span class="o">+</span><span class="n">k</span><span class="p">:</span><span class="mi">54</span><span class="o">+</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">o</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">54</span><span class="o">+</span><span class="n">k</span><span class="p">:</span><span class="mi">60</span><span class="o">+</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">60</span><span class="o">+</span><span class="n">k</span><span class="p">:</span><span class="mi">66</span><span class="o">+</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">sym</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">76</span><span class="o">+</span><span class="n">k</span><span class="p">:</span><span class="mi">78</span><span class="o">+</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">try</span><span class="p">:</span> <span class="n">charge</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">79</span><span class="o">+</span><span class="n">k</span><span class="p">:</span><span class="mi">80</span><span class="o">+</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">except</span><span class="p">:</span> <span class="n">charge</span><span class="o">=</span><span class="s">&#39; &#39;</span>					
                    <span class="n">atom</span> <span class="o">=</span> <span class="n">PDBatom</span><span class="p">(</span><span class="n">serial</span><span class="p">,</span><span class="n">atom_name</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">o</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">sym</span><span class="p">,</span><span class="n">charge</span><span class="p">)</span>
                    <span class="n">resObj</span><span class="o">.</span><span class="n">AddAtom</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span> <span class="k">break</span>
            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memHandle</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">memHandle</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resObj</span>
</div>
<div class="viewcode-block" id="PDBfile.hasModels"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBfile.hasModels">[docs]</a>    <span class="k">def</span> <span class="nf">hasModels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelIndices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span></div>
<div class="viewcode-block" id="PDBfile.getModelNames"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBfile.getModelNames">[docs]</a>    <span class="k">def</span> <span class="nf">getModelNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelIndices</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span></div>
<div class="viewcode-block" id="PDBfile.getChainNames"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBfile.getChainNames">[docs]</a>    <span class="k">def</span> <span class="nf">getChainNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains</span>
</div>
<div class="viewcode-block" id="PDBfile.iterResidueData"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBfile.iterResidueData">[docs]</a>    <span class="k">def</span> <span class="nf">iterResidueData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39; Yield the model number, chain name, and residue number </span>
<span class="sd">        for all residues present in this PDB file, not necessarily </span>
<span class="sd">        in order. &#39;&#39;&#39;</span>

        <span class="k">for</span> <span class="n">mod</span><span class="p">,</span><span class="n">ch</span><span class="p">,</span><span class="n">res</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">residueIndices</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">mod</span><span class="p">,</span><span class="n">ch</span><span class="p">,</span><span class="n">res</span>
</div>
<div class="viewcode-block" id="PDBfile.getResidueNamesInChain"><a class="viewcode-back" href="../../labblouin.PDBnet.html#labblouin.PDBnet.PDBfile.getResidueNamesInChain">[docs]</a>    <span class="k">def</span> <span class="nf">getResidueNamesInChain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ch</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span><span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">residueIndices</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">ch</span><span class="p">:</span> <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>

<span class="c"># Constants</span>
</div></div>
<span class="n">aa</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;ALA&#39;</span><span class="p">:</span><span class="s">&#39;A&#39;</span><span class="p">,</span><span class="s">&#39;CYS&#39;</span><span class="p">:</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;ASP&#39;</span><span class="p">:</span><span class="s">&#39;D&#39;</span><span class="p">,</span><span class="s">&#39;GLU&#39;</span><span class="p">:</span><span class="s">&#39;E&#39;</span><span class="p">,</span>
      <span class="s">&#39;PHE&#39;</span><span class="p">:</span><span class="s">&#39;F&#39;</span><span class="p">,</span><span class="s">&#39;GLY&#39;</span><span class="p">:</span><span class="s">&#39;G&#39;</span><span class="p">,</span><span class="s">&#39;HIS&#39;</span><span class="p">:</span><span class="s">&#39;H&#39;</span><span class="p">,</span><span class="s">&#39;ILE&#39;</span><span class="p">:</span><span class="s">&#39;I&#39;</span><span class="p">,</span>
      <span class="s">&#39;LYS&#39;</span><span class="p">:</span><span class="s">&#39;K&#39;</span><span class="p">,</span><span class="s">&#39;LEU&#39;</span><span class="p">:</span><span class="s">&#39;L&#39;</span><span class="p">,</span><span class="s">&#39;MET&#39;</span><span class="p">:</span><span class="s">&#39;M&#39;</span><span class="p">,</span><span class="s">&#39;ASN&#39;</span><span class="p">:</span><span class="s">&#39;N&#39;</span><span class="p">,</span>
      <span class="s">&#39;PRO&#39;</span><span class="p">:</span><span class="s">&#39;P&#39;</span><span class="p">,</span><span class="s">&#39;GLN&#39;</span><span class="p">:</span><span class="s">&#39;Q&#39;</span><span class="p">,</span><span class="s">&#39;ARG&#39;</span><span class="p">:</span><span class="s">&#39;R&#39;</span><span class="p">,</span><span class="s">&#39;SER&#39;</span><span class="p">:</span><span class="s">&#39;S&#39;</span><span class="p">,</span>
      <span class="s">&#39;THR&#39;</span><span class="p">:</span><span class="s">&#39;T&#39;</span><span class="p">,</span><span class="s">&#39;VAL&#39;</span><span class="p">:</span><span class="s">&#39;V&#39;</span><span class="p">,</span><span class="s">&#39;TRP&#39;</span><span class="p">:</span><span class="s">&#39;W&#39;</span><span class="p">,</span><span class="s">&#39;TYR&#39;</span><span class="p">:</span><span class="s">&#39;Y&#39;</span><span class="p">,</span>
      <span class="s">&#39;UNK&#39;</span><span class="p">:</span><span class="s">&#39;X&#39;</span><span class="p">}</span>

<span class="n">aa_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">aa</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span> <span class="c"># Flip above dictionary.</span>

<span class="n">aa_lists</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;ALA&#39;</span><span class="p">:[</span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="s">&#39;CA&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;O&#39;</span><span class="p">,</span><span class="s">&#39;CB&#39;</span><span class="p">],</span>\
            <span class="s">&#39;CYS&#39;</span><span class="p">:[</span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="s">&#39;CA&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;O&#39;</span><span class="p">,</span><span class="s">&#39;CB&#39;</span><span class="p">,</span><span class="s">&#39;SG&#39;</span><span class="p">],</span>\
            <span class="s">&#39;ASP&#39;</span><span class="p">:[</span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="s">&#39;CA&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;O&#39;</span><span class="p">,</span><span class="s">&#39;CB&#39;</span><span class="p">,</span><span class="s">&#39;CG&#39;</span><span class="p">,</span><span class="s">&#39;OD1&#39;</span><span class="p">,</span><span class="s">&#39;OD2&#39;</span><span class="p">],</span>\
            <span class="s">&#39;GLU&#39;</span><span class="p">:[</span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="s">&#39;CA&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;O&#39;</span><span class="p">,</span><span class="s">&#39;CB&#39;</span><span class="p">,</span><span class="s">&#39;CG&#39;</span><span class="p">,</span><span class="s">&#39;CD&#39;</span><span class="p">,</span><span class="s">&#39;OE1&#39;</span><span class="p">,</span><span class="s">&#39;OE2&#39;</span><span class="p">],</span>\
            <span class="s">&#39;PHE&#39;</span><span class="p">:[</span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="s">&#39;CA&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;O&#39;</span><span class="p">,</span><span class="s">&#39;CB&#39;</span><span class="p">,</span><span class="s">&#39;CG&#39;</span><span class="p">,</span><span class="s">&#39;CD1&#39;</span><span class="p">,</span><span class="s">&#39;CD2&#39;</span><span class="p">,</span><span class="s">&#39;CE1&#39;</span><span class="p">,</span><span class="s">&#39;CE2&#39;</span><span class="p">,</span><span class="s">&#39;CZ&#39;</span><span class="p">],</span>\
            <span class="s">&#39;GLY&#39;</span><span class="p">:[</span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="s">&#39;CA&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;O&#39;</span><span class="p">],</span>\
            <span class="s">&#39;HIS&#39;</span><span class="p">:[</span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="s">&#39;CA&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;O&#39;</span><span class="p">,</span><span class="s">&#39;CB&#39;</span><span class="p">,</span><span class="s">&#39;CG&#39;</span><span class="p">,</span><span class="s">&#39;ND1&#39;</span><span class="p">,</span><span class="s">&#39;CD2&#39;</span><span class="p">,</span><span class="s">&#39;CE1&#39;</span><span class="p">,</span><span class="s">&#39;NE2&#39;</span><span class="p">],</span>\
            <span class="s">&#39;ILE&#39;</span><span class="p">:[</span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="s">&#39;CA&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;O&#39;</span><span class="p">,</span><span class="s">&#39;CB&#39;</span><span class="p">,</span><span class="s">&#39;CG1&#39;</span><span class="p">,</span><span class="s">&#39;CG2&#39;</span><span class="p">,</span><span class="s">&#39;CD1&#39;</span><span class="p">],</span>\
            <span class="s">&#39;LYS&#39;</span><span class="p">:[</span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="s">&#39;CA&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;O&#39;</span><span class="p">,</span><span class="s">&#39;CB&#39;</span><span class="p">,</span><span class="s">&#39;CG&#39;</span><span class="p">,</span><span class="s">&#39;CD&#39;</span><span class="p">,</span><span class="s">&#39;CE&#39;</span><span class="p">,</span><span class="s">&#39;NZ&#39;</span><span class="p">],</span>\
            <span class="s">&#39;LEU&#39;</span><span class="p">:[</span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="s">&#39;CA&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;O&#39;</span><span class="p">,</span><span class="s">&#39;CB&#39;</span><span class="p">,</span><span class="s">&#39;CG&#39;</span><span class="p">,</span><span class="s">&#39;CD1&#39;</span><span class="p">,</span><span class="s">&#39;CD2&#39;</span><span class="p">],</span>\
            <span class="s">&#39;MET&#39;</span><span class="p">:[</span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="s">&#39;CA&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;O&#39;</span><span class="p">,</span><span class="s">&#39;CB&#39;</span><span class="p">,</span><span class="s">&#39;CG&#39;</span><span class="p">,</span><span class="s">&#39;SD&#39;</span><span class="p">,</span><span class="s">&#39;CE&#39;</span><span class="p">],</span>\
            <span class="s">&#39;ASN&#39;</span><span class="p">:[</span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="s">&#39;CA&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;O&#39;</span><span class="p">,</span><span class="s">&#39;CB&#39;</span><span class="p">,</span><span class="s">&#39;CG&#39;</span><span class="p">,</span><span class="s">&#39;OD1&#39;</span><span class="p">,</span><span class="s">&#39;ND2&#39;</span><span class="p">],</span>\
            <span class="s">&#39;PRO&#39;</span><span class="p">:[</span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="s">&#39;CA&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;O&#39;</span><span class="p">,</span><span class="s">&#39;CB&#39;</span><span class="p">,</span><span class="s">&#39;CG&#39;</span><span class="p">,</span><span class="s">&#39;CD&#39;</span><span class="p">],</span>\
            <span class="s">&#39;GLN&#39;</span><span class="p">:[</span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="s">&#39;CA&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;O&#39;</span><span class="p">,</span><span class="s">&#39;CB&#39;</span><span class="p">,</span><span class="s">&#39;CG&#39;</span><span class="p">,</span><span class="s">&#39;CD&#39;</span><span class="p">,</span><span class="s">&#39;OE1&#39;</span><span class="p">,</span><span class="s">&#39;NE2&#39;</span><span class="p">],</span>\
            <span class="s">&#39;ARG&#39;</span><span class="p">:[</span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="s">&#39;CA&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;O&#39;</span><span class="p">,</span><span class="s">&#39;CB&#39;</span><span class="p">,</span><span class="s">&#39;CG&#39;</span><span class="p">,</span><span class="s">&#39;CD&#39;</span><span class="p">,</span><span class="s">&#39;NE&#39;</span><span class="p">,</span><span class="s">&#39;CZ&#39;</span><span class="p">,</span><span class="s">&#39;NH1&#39;</span><span class="p">,</span><span class="s">&#39;NH2&#39;</span><span class="p">],</span>\
            <span class="s">&#39;SER&#39;</span><span class="p">:[</span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="s">&#39;CA&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;O&#39;</span><span class="p">,</span><span class="s">&#39;CB&#39;</span><span class="p">,</span><span class="s">&#39;OG&#39;</span><span class="p">],</span>\
            <span class="s">&#39;THR&#39;</span><span class="p">:[</span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="s">&#39;CA&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;O&#39;</span><span class="p">,</span><span class="s">&#39;CB&#39;</span><span class="p">,</span><span class="s">&#39;OG1&#39;</span><span class="p">,</span><span class="s">&#39;CG2&#39;</span><span class="p">],</span>\
            <span class="s">&#39;VAL&#39;</span><span class="p">:[</span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="s">&#39;CA&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;O&#39;</span><span class="p">,</span><span class="s">&#39;CB&#39;</span><span class="p">,</span><span class="s">&#39;CG1&#39;</span><span class="p">,</span><span class="s">&#39;CG2&#39;</span><span class="p">],</span>\
            <span class="s">&#39;TRP&#39;</span><span class="p">:[</span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="s">&#39;CA&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;O&#39;</span><span class="p">,</span><span class="s">&#39;CB&#39;</span><span class="p">,</span><span class="s">&#39;CG&#39;</span><span class="p">,</span><span class="s">&#39;CD1&#39;</span><span class="p">,</span><span class="s">&#39;CD2&#39;</span><span class="p">,</span><span class="s">&#39;NE1&#39;</span><span class="p">,</span><span class="s">&#39;CE2&#39;</span><span class="p">,</span><span class="s">&#39;CE3&#39;</span><span class="p">,</span><span class="s">&#39;CZ2&#39;</span><span class="p">,</span><span class="s">&#39;CZ3&#39;</span><span class="p">,</span><span class="s">&#39;CH2&#39;</span><span class="p">],</span>\
            <span class="s">&#39;TYR&#39;</span><span class="p">:[</span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="s">&#39;CA&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;O&#39;</span><span class="p">,</span><span class="s">&#39;CB&#39;</span><span class="p">,</span><span class="s">&#39;CG&#39;</span><span class="p">,</span><span class="s">&#39;CD1&#39;</span><span class="p">,</span><span class="s">&#39;CD2&#39;</span><span class="p">,</span><span class="s">&#39;CE1&#39;</span><span class="p">,</span><span class="s">&#39;CE2&#39;</span><span class="p">,</span><span class="s">&#39;CZ&#39;</span><span class="p">,</span><span class="s">&#39;OH&#39;</span><span class="p">],</span>\
            <span class="s">&#39;UNK&#39;</span><span class="p">:[]}</span>

<span class="c"># Debugging</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">mystructure</span> <span class="o">=</span> <span class="n">PDBstructure</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="c">#lis = mystructure.FDmatrix(&quot;test.fasta&quot;) # for debugging purposes only</span>
    <span class="c"># mystructure.Map2Protein(&#39;test2.pdb&#39;,lis,0,&#39;test.fasta&#39;)# for debugging purposes only</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;RMSD&#39;</span><span class="p">,</span><span class="n">mystructure</span><span class="o">.</span><span class="n">rmsd</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">print</span> <span class="s">&#39;RRMSD&#39;</span><span class="p">,</span><span class="n">mystructure</span><span class="o">.</span><span class="n">rrmsd</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">print</span> <span class="s">&#39;TMscore&#39;</span><span class="p">,</span><span class="n">mystructure</span><span class="o">.</span><span class="n">tmscore</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">print</span> <span class="s">&#39;GDT&#39;</span><span class="p">,</span><span class="n">mystructure</span><span class="o">.</span><span class="n">gdt</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">x</span> <span class="o">=</span>  <span class="n">mystructure</span><span class="o">.</span><span class="n">GetAllCentroid</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">)</span>
    <span class="n">mystructure</span><span class="o">.</span><span class="n">Contacts</span><span class="p">()</span>
    <span class="k">print</span> <span class="n">mystructure</span><span class="o">.</span><span class="n">contactmap</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">LabBlouinTools 0.3.4 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Christian Blouin, Alex Safatli, Jose Sergio Hleap.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>